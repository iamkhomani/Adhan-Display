<!DOCTYPE html>
<html lang="en">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-BEKQEF4RR5"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-BEKQEF4RR5');
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#050505">
    
    <title>Adhan Display | Smart Islamic Dashboard & Prayer Tracker</title>
    <meta name="description" content="Free smart Adhan dashboard & Islamic prayer tracker. Get offline live prayer times, Qibla compass, and daily inspiration with no subscriptions.">
    <meta name="keywords" content="adhan dashboard, prayer tracker, islamic smart clock, salah tracker, qibla compass, web adhan display, waqtly alternative, bilaal alternative, free prayer app">
    <meta name="author" content="Adhan Display">
    
    <meta property="og:type" content="website">
    <meta property="og:title" content="Adhan Display | Smart Islamic Dashboard & Prayer Tracker">
    <meta property="og:description" content="Turn any device into a beautiful, free Adhan display and Salah tracker with offline support and a live Qibla compass.">
    <meta property="og:image" content="images/adhan display muslim prayer times dashboard background.jpg">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Adhan Display | Smart Islamic Dashboard">
    <meta name="twitter:description" content="Turn any device into a free Adhan display and Salah tracker.">

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Adhan Display",
      "description": "A smart Islamic dashboard featuring live prayer times, offline Salah tracking, and Qibla direction.",
      "applicationCategory": "LifestyleApplication",
      "operatingSystem": "Any",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      }
    }
    </script>

    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Adhan Display">
    <link rel="apple-touch-icon" href="images/adhan display muslim prayer times dashboard logo.png">

    <link rel="icon" type="image/png" href="images/adhan display muslim prayer times dashboard logo.png">
    <link rel="manifest" href="manifest.json">

    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600;800&display=swap" rel="stylesheet">
    
    <style>
        /* === THEME VARIABLES === */
        :root {
            --bg-image: url('images/adhan display muslim prayer times dashboard background.jpg');
            --gold: #D4AF37; --gold-dim: #997d26; --gold-hover: #e8c558;
            --glass-bg: rgba(20, 20, 20, 0.85);
            --glass-header: rgba(0, 0, 0, 0.65);
            --text-main: #f0f0f0; --text-muted: #aaaaaa;
            --border-color: #333333; --progress-bg: #222222;
            --shadow-color: rgba(0,0,0,0.5);
            --danger: #ff4444; --success: #2ecc71; --info: #3498db;
            --highlight-bg: rgba(212, 175, 55, 0.1);
        }

        [data-theme="light"] {
            --bg-image: url('images/background-white.jpg');
            --gold: #b8972e; --gold-dim: #8a7122; --gold-hover: #d1b145;
            --glass-bg: rgba(255, 255, 255, 0.85);
            --glass-header: rgba(240, 240, 240, 0.85);
            --text-main: #1a1a1a; --text-muted: #555555;
            --border-color: #dddddd; --progress-bg: #e0e0e0;
            --shadow-color: rgba(0,0,0,0.1);
            --highlight-bg: rgba(184, 151, 46, 0.15);
        }

        [data-theme="green"] {
            --bg-image: url('images/background-green.png');
            --gold: #D4AF37; --gold-dim: #997d26; --gold-hover: #e8c558;
            --glass-bg: rgba(10, 35, 20, 0.85);
            --glass-header: rgba(5, 20, 10, 0.8);
            --text-main: #f0f0f0; --text-muted: #cccccc;
            --border-color: #1a4d2e; --progress-bg: #0a1f12;
            --shadow-color: rgba(0,0,0,0.6);
            --highlight-bg: rgba(212, 175, 55, 0.15);
        }

        [data-theme="dynamic"] {
            --glass-bg: rgba(15, 15, 20, 0.85); 
            --glass-header: rgba(10, 10, 15, 0.75);
            --border-color: rgba(212, 175, 55, 0.3);
            --shadow-color: rgba(0,0,0,0.7);
        }
        [data-theme="dynamic"][data-time-of-day="fajr"] {
            --bg-image: linear-gradient(135deg, #0d0a1a 0%, #2b183d 50%, #5e2843 100%);
            --text-main: #ffe6e6;
        }
        [data-theme="dynamic"][data-time-of-day="day"] {
            --bg-image: linear-gradient(135deg, #1a2a6c 0%, #11998e 50%, #2b3a4a 100%);
            --text-main: #f0f8ff;
        }
        [data-theme="dynamic"][data-time-of-day="night"] {
            --bg-image: linear-gradient(135deg, #050505 0%, #0a0a1a 50%, #1a1a2e 100%);
            --text-main: #e0e0e0;
        }

        /* Custom Theme Overrides */
        [data-theme="custom"] {
            --glass-bg: rgba(15, 15, 20, 0.80); 
            --glass-header: rgba(10, 10, 15, 0.70);
            --border-color: rgba(212, 175, 55, 0.4);
            --shadow-color: rgba(0,0,0,0.8);
            --text-main: #f0f0f0;
        }

        html { font-size: 16px; transition: font-size 0.3s ease; scroll-behavior: smooth; }

        body {
            background-color: #050505; color: var(--text-main);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0; min-height: 100vh; padding-bottom: 80px;
            display: flex; flex-direction: column; overflow-x: hidden;
            transition: color 0.5s ease;
        }

        body::before {
            content: ''; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background-image: var(--bg-image); background-size: cover;
            background-position: center; background-repeat: no-repeat;
            z-index: -1; transition: background-image 1s ease;
        }

        html[dir="rtl"] body { font-family: 'Tajawal', 'Segoe UI', sans-serif; }
        html[dir="rtl"] .top-left-logo { left: auto; right: 20px; }
        html[dir="rtl"] .top-controls { right: auto; left: 20px; }

        .dashboard-container {
            max-width: 1400px; margin: 0 auto; padding: 20px;
            display: grid; grid-template-columns: repeat(12, 1fr);
            gap: 20px; flex: 1; position: relative; width: 100%; box-sizing: border-box;
            transition: all 0.5s ease;
        }

        /* Fixed Top Controls */
        .top-left-logo { position: absolute; top: 20px; left: 20px; width: clamp(50px, 8vw, 70px); height: auto; z-index: 10; }

        .top-controls {
            position: absolute; top: 20px; right: 20px; display: flex; gap: 10px; z-index: 100;
        }

        .control-btn {
            background: var(--glass-bg); border: 1px solid var(--gold); color: var(--text-main); 
            cursor: pointer; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 10px var(--shadow-color); transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            height: 45px;
        }
        .control-btn.icon-only { width: 45px; border-radius: 50%; font-size: 1.4rem; }
        .control-btn.text-btn { padding: 0 15px; border-radius: 25px; font-weight: bold; font-size: 0.95rem; gap: 6px; }
        .control-btn:hover { transform: scale(1.05) translateY(-2px); background: var(--gold); color: #050505; box-shadow: 0 6px 15px rgba(212, 175, 55, 0.3); }

        /* Focus Mode Styles */
        body.focus-mode .dashboard-container > *:not(.prayer-hero) { display: none !important; }
        body.focus-mode header, body.focus-mode footer, body.focus-mode .top-left-logo { display: none !important; }
        body.focus-mode .dashboard-container { 
            display: flex !important; align-items: center !important; justify-content: center !important; 
            min-height: 100vh !important; padding: 20px !important; margin: 0 !important; 
        }
        body.focus-mode .prayer-hero { 
            width: 100% !important; max-width: 1000px !important; 
            background: var(--glass-bg) !important; border: 2px solid var(--gold) !important; 
            box-shadow: 0 20px 50px var(--shadow-color) !important; backdrop-filter: blur(15px) !important; 
            padding: 50px !important; min-height: auto !important; border-radius: 20px !important; 
            display: flex !important; flex-direction: row !important; justify-content: space-between !important; align-items: center !important; gap: 40px !important;
        }
        body.focus-mode .hero-main { flex: 1; text-align: center; display: flex; flex-direction: column; align-items: center; justify-content: center; width: 100%; }
        body.focus-mode .hero-side { display: flex; flex-direction: column; flex: 0 0 300px; border-left: 1px solid var(--border-color); padding-left: 40px; }
        body.focus-mode .prayer-name-display { font-size: clamp(3rem, 10vw, 6rem) !important; margin: 15px 0 !important; }
        body.focus-mode .countdown-display { font-size: clamp(2.5rem, 8vw, 4.5rem) !important; margin-bottom: 25px !important; }
        body.focus-mode .progress-container { height: 18px !important; margin-top: 30px !important; border-radius: 10px !important; width: 100% !important; }
        body.focus-mode #status-label, body.focus-mode #next-label { font-size: clamp(1.2rem, 3vw, 1.8rem) !important; letter-spacing: 2px !important; }
        body.focus-mode #curr-time { font-size: clamp(1.8rem, 5vw, 2.5rem) !important; margin-bottom: 20px !important; }
        body.focus-mode #focus-btn { border-color: var(--gold) !important; background: var(--gold) !important; color: #050505 !important; z-index: 1000 !important; }
        body.focus-mode .fullscreen-toggle { z-index: 1000 !important; }

        @media (max-width: 850px) {
            body.focus-mode .prayer-hero { flex-direction: column !important; padding: 40px 20px !important; gap: 30px !important; }
            body.focus-mode .hero-side { border-left: none; border-top: 1px solid var(--border-color); padding-left: 0; padding-top: 25px; flex: auto; width: 100%; }
        }

        /* Unified Cards */
        .card { background: var(--glass-bg); border: 1px solid var(--gold); border-radius: 12px; padding: 25px 20px; backdrop-filter: blur(10px); box-shadow: 0 4px 20px var(--shadow-color); transition: all 0.3s ease; display: flex; flex-direction: column; justify-content: center; align-items: center; grid-column: span 12; box-sizing: border-box; width: 100%; position: relative; }
        .card:hover { box-shadow: 0 6px 25px rgba(212, 175, 55, 0.15); transform: translateY(-2px); }
        .widget-title { color: var(--gold-dim); text-transform: uppercase; font-size: 0.85rem; border-bottom: 1px solid var(--gold); width: 100%; text-align: center; padding-bottom: 8px; margin-bottom: 15px; letter-spacing: 1px; font-weight: bold; }
        
        .header-section { grid-column: span 12; text-align: center; margin-bottom: 20px; display: flex; justify-content: center; margin-top: 70px; width: 100%; }
        .title-wrapper { background: var(--glass-header); backdrop-filter: blur(8px); padding: clamp(15px, 4vw, 20px) clamp(20px, 5vw, 40px); border-radius: 20px; border: 1px solid var(--gold); box-shadow: 0 10px 30px var(--shadow-color); width: 100%; max-width: 800px; box-sizing: border-box; }
        h1 { font-family: 'Cinzel', serif; color: var(--gold); font-size: clamp(1.4rem, 4vw, 2.4rem); margin: 0; text-transform: uppercase; letter-spacing: clamp(1px, 2vw, 3px); text-shadow: 0 2px 10px var(--shadow-color); }
        h2 { font-size: clamp(0.75rem, 2vw, 0.9rem); color: var(--text-muted); font-weight: 400; margin: 5px 0 10px 0; letter-spacing: 0.5px; text-transform: uppercase; }
        
        .info-panel { grid-column: span 12; display: flex; flex-wrap: wrap; justify-content: space-around; align-items: center; background: var(--glass-header); border-radius: 12px; padding: 15px; border: 1px solid var(--gold); gap: 15px; box-shadow: 0 4px 10px var(--shadow-color); }
        .date-box { text-align: center; min-width: 100px; flex: 1; padding: 5px; }
        .date-label { color: var(--gold-dim); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px; font-weight: bold;}
        .date-val { font-size: clamp(1rem, 3vw, 1.2rem); font-weight: bold; color: var(--text-main); }
        .live-clock { font-size: clamp(1.4rem, 4vw, 1.8rem); font-family: 'Courier New', monospace; color: var(--text-main); font-weight: bold; }

        /* Banners */
        .banner { display: none; grid-column: span 12; width: 100%; box-sizing: border-box; padding: 12px 20px; border-radius: 12px; text-align: center; font-weight: bold; letter-spacing: 1px; box-shadow: 0 4px 10px var(--shadow-color); animation: pulse 2s infinite; }
        #sunnah-banner { background: rgba(46, 204, 113, 0.15); border: 1px solid var(--success); color: var(--success); }
        #jumuah-banner { background: rgba(212, 175, 55, 0.15); border: 1px solid var(--gold); color: var(--gold); }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(46, 204, 113, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(46, 204, 113, 0); } 100% { box-shadow: 0 0 0 0 rgba(46, 204, 113, 0); } }

        /* Hero */
        .hero-side { display: none; }
        .prayer-hero { text-align: center; position: relative; width: 100%; display: flex; flex-direction: column; justify-content: space-between; align-items: center; min-height: 320px; scroll-margin-top: 80px; }
        .hero-main { width: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; flex: 1; }
        .prayer-name-display { font-size: clamp(2.5rem, 8vw, 3.5rem); color: var(--gold); font-weight: 800; line-height: 1.1; margin: 10px 0; letter-spacing: 2px; }
        .countdown-display { font-size: clamp(1.8rem, 6vw, 2.2rem); font-family: 'Courier New', monospace; color: var(--text-main); font-weight: bold; }
        #shuruq-warning { color: var(--danger); font-size: 0.9rem; font-weight: bold; display: none; margin-bottom: 10px; letter-spacing: 1px; }

        .progress-container { width: 100%; height: 12px; background: var(--progress-bg); border-radius: 6px; overflow: hidden; border: 1px solid var(--border-color); margin-top: 20px;}
        .progress-bar { height: 100%; background: var(--gold); width: 0%; transition: width 1s linear; will-change: width; }

        /* Modals & Inputs */
        .modal-overlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.85); display: none; align-items: flex-start; 
            justify-content: center; z-index: 2000; backdrop-filter: blur(8px); 
            opacity: 0; transition: opacity 0.3s ease; overflow-y: auto; padding: 5vh 15px; box-sizing: border-box;
        }
        .modal-overlay.active { display: flex; opacity: 1; }
        .settings-panel { 
            background: var(--glass-bg); border: 1px solid var(--gold); padding: 35px 25px; 
            border-radius: 16px; width: 100%; max-width: 480px; position: relative; 
            color: var(--text-main); box-shadow: 0 15px 50px rgba(0,0,0,0.9); margin: 0 auto auto auto; 
        }
        .close-btn { 
            position: absolute; top: 12px; right: 12px; background: rgba(255, 68, 68, 0.9); border: 2px solid #fff; 
            font-size: 1.6rem; color: #fff; cursor: pointer; width: 38px; height: 38px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 10px rgba(0,0,0,0.6); transition: transform 0.2s; z-index: 10000;
        }
        .close-btn:hover { transform: scale(1.1); background: #cc0000; }
        html[dir="rtl"] .close-btn { right: auto; left: 12px; }

        .setting-group { margin-bottom: 25px; }
        .setting-group label { display: block; margin-bottom: 10px; font-weight: bold; color: var(--gold); text-transform: uppercase; font-size: 0.85rem; letter-spacing: 1px; }
        .flex-options { display: flex; gap: 8px; flex-wrap: wrap; }
        
        .opt-btn, input[type="text"], input[type="number"], select { 
            flex: 1 1 auto; min-width: 40px; padding: 12px 10px; background: rgba(0,0,0,0.4); 
            border: 1px solid var(--border-color); color: var(--text-main); border-radius: 8px; 
            font-family: inherit; font-size: 0.95rem; transition: all 0.2s; outline: none; box-sizing: border-box;
        }
        select option { background-color: #1a1a1a; color: #fff; }
        button.opt-btn { cursor: pointer; font-weight: bold; text-align: center; }
        button.opt-btn:hover { border-color: var(--gold); background: var(--highlight-bg); }
        button.opt-btn.active { background: var(--gold); color: #050505; border-color: var(--gold); }

        input[type="text"]:focus, input[type="number"]:focus, select:focus { border-color: var(--gold); box-shadow: 0 0 10px rgba(212, 175, 55, 0.2); background: rgba(0,0,0,0.6); }
        input[type="range"] { flex: 1; accent-color: var(--gold); margin: 10px 0; }
        input[type="file"] { padding: 8px; }

        .toggle-row { display: flex; justify-content: space-between; align-items: center; padding: 15px; border: 1px solid var(--border-color); border-radius: 8px; margin-bottom: 10px; background: rgba(0,0,0,0.2); gap: 15px; }
        .toggle-row span { flex: 1; line-height: 1.4; }
        
        .preview-btn { background: rgba(0,0,0,0.4); border: 1px solid var(--border-color); color: var(--gold); border-radius: 8px; padding: 0 18px; cursor: pointer; transition: 0.2s; font-size: 1rem; }
        .preview-btn:hover { border-color: var(--gold); background: var(--gold); color: #050505; }

        .btn-gold { 
            background: transparent; border: 2px solid var(--gold); color: var(--gold); padding: 12px 20px; 
            font-size: 0.95rem; text-transform: uppercase; letter-spacing: 1px; cursor: pointer; text-decoration: none; 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); border-radius: 8px; font-weight: bold; display: inline-flex; 
            align-items: center; justify-content: center; gap: 10px; margin-top: 10px; width: 100%; max-width: 300px; box-sizing: border-box; text-align: center; 
        }
        .btn-gold:hover { background: var(--gold); color: #050505; box-shadow: 0 4px 15px rgba(212, 175, 55, 0.4); transform: translateY(-2px); }

        .history-row { display: flex; justify-content: space-between; align-items: center; padding: 14px 12px; border-bottom: 1px solid var(--border-color); cursor: pointer; transition: all 0.2s ease; border-radius: 6px; margin-bottom: 4px; background: rgba(255,255,255,0.02); }
        .history-row:hover { background: var(--highlight-bg); transform: translateX(4px); border-color: var(--gold-dim); }
        .streak-badge { color: #ff9800; font-weight: bold; font-size: 1.1rem; margin-bottom: 20px; text-align: center; background: rgba(255,152,0,0.1); padding: 12px; border-radius: 8px; border: 1px solid rgba(255,152,0,0.3); text-transform: uppercase; letter-spacing: 1px;}

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--gold-dim); }

        .history-container { display: flex; gap: 20px; flex-wrap: wrap; width: 100%; }
        .history-box { flex: 1 1 300px; padding: 20px; background: var(--glass-header); border-radius: 12px; border: 1px solid var(--border-color); box-sizing: border-box; }
        
        .tasbih-circle { width: 140px; height: 140px; border-radius: 50%; background: var(--glass-header); border: 3px solid var(--gold); color: var(--gold); font-size: 3rem; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.15s ease; box-shadow: 0 4px 15px var(--shadow-color); -webkit-tap-highlight-color: transparent; margin: 10px 0; user-select: none; }
        .tasbih-circle:active { transform: scale(0.92); background: rgba(212, 175, 55, 0.2); }
        .tasbih-circle.glow { background: var(--gold); color: #050505; box-shadow: 0 0 30px var(--gold); border-color: #fff; }

        .footer-nav { display: flex; justify-content: center; gap: 20px; margin-bottom: 15px; flex-wrap: wrap; }
        .footer-nav a { color: var(--gold-dim); text-decoration: none; font-size: 0.85rem; font-weight: bold; text-transform: uppercase; letter-spacing: 1px; transition: color 0.2s; }
        .footer-nav a:hover { color: var(--gold); }

        footer { margin-top: auto; text-align: center; padding: 40px 20px; border-top: 1px solid var(--gold); background: var(--glass-header); width: 100%; box-sizing: border-box; }

        /* Anchor scroll offset for fixed headers/controls */
        #tracker { scroll-margin-top: 80px; }
        #qibla { scroll-margin-top: 80px; }
        #times-card { scroll-margin-top: 80px; }

        @media (min-width: 768px) {
            .prayer-hero, .history-card { grid-column: span 12; }
            .times-card, .tasbih-card, .qibla-card, .tools-card, .text-widget, .dua-widget, .night-widget, .names-widget, .ramadan-widget, .video-card { grid-column: span 6; }
            #install-card-section { grid-column: span 12; }
            .fullscreen-toggle { right: 135px; }
        }
        @media (min-width: 1024px) {
            .prayer-hero { grid-column: span 6; } 
            .times-card { grid-column: span 6; }
            .history-card { grid-column: span 12; }
            .tasbih-card, .qibla-card, .text-widget { grid-column: span 4; } 
            .night-widget, .names-widget, .dua-widget { grid-column: span 4; } 
            .ramadan-widget { grid-column: span 12; } 
            .tools-card, .video-card { grid-column: span 6; } 
            #install-card-section { grid-column: span 12; }
        }
        @media (max-width: 767px) {
            .top-left-logo { top: 15px; left: 15px; width: 50px; }
            .top-controls { top: 15px; right: 15px; gap: 8px; }
            .control-btn { height: 40px; }
            .control-btn.icon-only { width: 40px; font-size: 1.1rem; }
            .control-btn.text-btn { padding: 0 12px; font-size: 0.85rem; gap: 4px; }
            .header-section { margin-top: 60px; }
            .info-panel { flex-direction: column; gap: 5px; }
            .date-box { width: 100%; padding: 10px 0; border-bottom: 1px solid var(--border-color); }
            .date-box:last-child { border-bottom: none; }
        }

        /* FIX: Hide Fullscreen button and Install banner if running as an installed PWA */
        @media all and (display-mode: standalone) {
            #install-card-section { display: none !important; }
            #fullscreen-btn { display: none !important; }
        }
    </style>
</head>
<body>

    <audio id="audio-chime" src="audio/chime.mp3" preload="metadata"></audio>
    <audio id="audio-default" src="audio/adhan.mp3" preload="metadata"></audio>
    <audio id="audio-makkah" src="audio/makkah.mp3" preload="none"></audio>
    <audio id="audio-madinah" src="audio/madinah.mp3" preload="none"></audio>
    <audio id="audio-alafasy" src="audio/alafasy.mp3" preload="none"></audio>

    <div class="top-controls">
        <button id="fullscreen-btn" class="control-btn icon-only" aria-label="Fullscreen" title="Fullscreen">‚õ∂</button>
        <button id="focus-btn" class="control-btn text-btn" aria-label="Focus Mode">üïã Focus Mode</button>
        <button id="settings-btn" class="control-btn icon-only" aria-label="Settings" title="Settings">‚öôÔ∏è</button>
    </div>
    
    <div id="onboarding-modal" class="modal-overlay" style="z-index: 3000;">
        <div class="settings-panel" style="text-align: center; max-width: 420px; padding-top: 45px;">
            <h2 style="color:var(--gold); margin-top:0; font-family:'Cinzel',serif; font-size: 1.8rem; letter-spacing: 1px;">Welcome</h2>
            <p style="color:var(--text-muted); font-size:0.95rem; margin-bottom:30px; line-height: 1.5;">Personalize your Adhan Display experience. This data is only stored locally.</p>
            
            <div class="setting-group" style="text-align: left;">
                <label>First Name</label>
                <input type="text" id="ob-name" placeholder="e.g. Tariq">
            </div>
            
            <div class="setting-group" style="text-align: left;">
                <label>Birth Year</label>
                <input type="number" id="ob-year" placeholder="e.g. 1995" min="1900" max="2026">
            </div>
            
            <div style="display: flex; gap: 15px; margin-bottom: 30px;">
                <div class="setting-group" style="flex: 1; text-align: left; margin-bottom: 0;">
                    <label>Gender</label>
                    <select id="ob-gender">
                        <option value="">Select...</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                    </select>
                </div>
                <div class="setting-group" style="flex: 1; text-align: left; margin-bottom: 0;">
                    <label>Background</label>
                    <select id="ob-bg">
                        <option value="">Select...</option>
                        <option value="born">Born Muslim</option>
                        <option value="revert">Revert</option>
                    </select>
                </div>
            </div>
            
            <div style="display: flex; gap: 15px;">
                <button onclick="finishOnboarding(true)" class="btn-gold" style="flex: 2; margin: 0; padding: 14px;">Save & Continue</button>
                <button onclick="finishOnboarding(false)" class="opt-btn" style="flex: 1; margin: 0; padding: 14px;">Skip</button>
            </div>
        </div>
    </div>

    <div id="settings-modal" class="modal-overlay">
        <div class="settings-panel">
            <button id="close-settings" class="close-btn" title="Close Settings">√ó</button>
            <h3 data-i18n="pref" style="color:var(--gold); margin-top:0; border-bottom:1px solid var(--gold); padding-bottom:15px; margin-bottom: 25px; font-size: 1.4rem;">Preferences</h3>
            
            <div class="setting-group">
                <label>Locations</label>
                <div id="location-list" style="margin-bottom: 10px; display: flex; flex-direction: column; gap: 8px;"></div>
                <div style="display: flex; gap: 8px; margin-top: 15px; border-top: 1px dashed var(--border-color); padding-top: 15px;">
                    <input type="text" id="new-loc-name" placeholder="City name (e.g. London)">
                    <button onclick="addManualLocation()" class="btn-gold" style="width:auto; margin:0; padding: 12px 20px;">Add</button>
                </div>
            </div>

            <div class="setting-group">
                <label>Calculation Method</label>
                <select id="calc-method">
                    <option value="2">Islamic Society of North America (ISNA)</option>
                    <option value="3" selected>Muslim World League (MWL)</option>
                    <option value="4">Umm Al-Qura University, Makkah</option>
                    <option value="5">Egyptian General Authority of Survey</option>
                    <option value="8">Gulf Region</option>
                    <option value="9">Kuwait</option>
                    <option value="10">Qatar</option>
                    <option value="11">Majlis Ugama Islam Singapura, Singapore</option>
                    <option value="12">Union Organization islamic de France</option>
                    <option value="13">Diyanet ƒ∞≈üleri Ba≈ükanlƒ±ƒüƒ±, Turkey</option>
                </select>
            </div>

            <div style="display: flex; gap: 15px;">
                <div class="setting-group" style="flex: 1;">
                    <label>Manual Offset (Min)</label>
                    <input type="number" id="manual-offset" value="0" placeholder="e.g. 5">
                </div>
                <div class="setting-group" style="flex: 1;">
                    <label>Hijri Offset (Days)</label>
                    <input type="number" id="hijri-offset" value="0" min="-2" max="2" placeholder="e.g. 1">
                </div>
            </div>
            <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: -10px; margin-bottom: 25px; line-height: 1.4;">Adjust times to perfectly match your local mosque/moon sighting.</div>

            <div class="setting-group">
                <label data-i18n="lang">Language</label>
                <select id="lang-select" class="opt-btn" style="width: 100%;">
                    <option value="en">üá¨üáß English</option>
                    <option value="ar">üá∏üá¶ ÿßŸÑÿπÿ±ÿ®Ÿäÿ© (Arabic)</option>
                    <option value="ur">üáµüá∞ ÿßÿ±ÿØŸà (Urdu)</option>
                    <option value="id">üáÆüá© Bahasa Indonesia</option>
                    <option value="bn">üáßüá© ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ (Bengali)</option>
                    <option value="tr">üáπüá∑ T√ºrk√ße</option>
                    <option value="fr">üá´üá∑ Fran√ßais</option>
                    <option value="de">üá©üá™ Deutsch</option>
                    <option value="nl">üá≥üá± Nederlands</option>
                    <option value="es">üá™üá∏ Espa√±ol</option>
                    <option value="ru">üá∑üá∫ –†—É—Å—Å–∫–∏–π</option>
                </select>
            </div>

            <div class="setting-group">
                <label data-i18n="theme">Theme Background</label>
                <div class="flex-options">
                    <button class="opt-btn theme-btn" data-theme-val="dark">Dark</button>
                    <button class="opt-btn theme-btn" data-theme-val="light">Light</button>
                    <button class="opt-btn theme-btn" data-theme-val="green">Green</button>
                    <button class="opt-btn theme-btn" data-theme-val="dynamic" data-i18n="dynamic">Dynamic</button>
                    <button class="opt-btn theme-btn" data-theme-val="custom">Custom</button>
                </div>
                
                <div id="custom-bg-section" style="display: none; margin-top: 15px; padding: 15px; border: 1px dashed var(--gold); border-radius: 8px;">
                    <label style="font-size: 0.85rem; text-transform: none; color: var(--gold);">Upload Custom Image</label>
                    <input type="file" id="custom-bg-upload" accept="image/*" class="opt-btn" style="padding: 8px; width: 100%; margin-top: 5px;">
                    <div style="font-size: 0.75rem; color: var(--text-muted); margin-top: 8px;">Image is automatically compressed and saved locally.</div>
                </div>
            </div>

            <div class="setting-group">
                <label data-i18n="size">Text Size</label>
                <div class="flex-options">
                    <button class="opt-btn text-btn" data-size-val="small">A-</button>
                    <button class="opt-btn text-btn" data-size-val="normal">A</button>
                    <button class="opt-btn text-btn" data-size-val="large">A+</button>
                </div>
            </div>

            <div class="setting-group">
                <label data-i18n="audio_pref">Audio & Alerts</label>
                <div style="display: flex; flex-direction: column; gap: 8px; margin-bottom: 15px;">
                    <div style="display: flex; gap: 8px;">
                        <button class="opt-btn adhan-btn" data-adhan-val="default" style="flex: 1;">Default</button>
                        <button class="preview-btn" onclick="previewAudio('default', this)" title="Play/Stop">‚ñ∂</button>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button class="opt-btn adhan-btn" data-adhan-val="makkah" style="flex: 1;">Makkah</button>
                        <button class="preview-btn" onclick="previewAudio('makkah', this)" title="Play/Stop">‚ñ∂</button>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button class="opt-btn adhan-btn" data-adhan-val="madinah" style="flex: 1;">Madinah</button>
                        <button class="preview-btn" onclick="previewAudio('madinah', this)" title="Play/Stop">‚ñ∂</button>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button class="opt-btn adhan-btn" data-adhan-val="alafasy" style="flex: 1;">Alafasy</button>
                        <button class="preview-btn" onclick="previewAudio('alafasy', this)" title="Play/Stop">‚ñ∂</button>
                    </div>
                    <button class="opt-btn adhan-btn" data-adhan-val="none" style="width: 100%;">None</button>
                </div>
                
                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px; padding: 0 5px;">
                    <span style="font-size: 0.95rem; font-weight: 500; color: var(--gold);">Volume</span>
                    <input type="range" id="adhan-volume" min="0" max="1" step="0.1" value="1">
                </div>

                <div class="toggle-row">
                    <span data-i18n="wudu_alert" style="font-size: 0.95rem; font-weight: 500;">10-Min Wudu Alert & Push</span>
                    <label class="switch" style="cursor: pointer;">
                        <input type="checkbox" id="wudu-toggle" style="accent-color: var(--gold); transform: scale(1.4); cursor: pointer;">
                    </label>
                </div>

                <div class="toggle-row">
                    <span style="font-size: 0.95rem; font-weight: 500;">9:00 AM Daily Inspiration</span>
                    <label class="switch" style="cursor: pointer;">
                        <input type="checkbox" id="daily-alert-toggle" style="accent-color: var(--gold); transform: scale(1.4); cursor: pointer;">
                    </label>
                </div>
            </div>

            <div class="setting-group">
                <label data-i18n="daily_source">Daily Inspiration Source</label>
                <div class="flex-options">
                    <button class="opt-btn text-source-btn" data-source-val="quran">Ayah</button>
                    <button class="opt-btn text-source-btn" data-source-val="hadith">Hadith</button>
                </div>
            </div>

            <div class="setting-group" style="margin-top: 35px; border-top: 1px solid var(--border-color); padding-top: 25px;">
                <label>Data Management</label>
                <button onclick="exportPrayerData()" class="btn-gold" style="width: 100%; max-width: 100%; margin: 0;">üì• Export Prayer Data (CSV)</button>
                <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 8px; text-align: center;">Download a spreadsheet of your tracked Salah history.</div>
            </div>

        </div>
    </div>

    <main class="dashboard-container">
        <img src="images/adhan display muslim prayer times dashboard logo.png" alt="Adhan Display Logo" class="top-left-logo">

        <header class="header-section">
            <div class="title-wrapper">
                <h1>Adhan Display & Prayer Tracker</h1>
                <h2 data-i18n="subtitle">The Ultimate Free Islamic Prayer Times & Qibla Dashboard</h2>
                <div id="welcome-message" style="color: var(--gold); font-size: 1.1rem; margin-top: 10px; font-weight: bold; display: none;"></div>
            </div>
        </header>

        <section class="info-panel">
            <div class="date-box">
                <div class="date-label" data-i18n="greg">Gregorian</div>
                <div class="date-val" id="greg-date">--/--/----</div>
            </div>
            <div class="date-box">
                <div class="date-label" data-i18n="time">Current Time</div>
                <div class="live-clock" id="live-clock">--:--:--</div>
                <div id="weather-display" style="font-size: 0.85rem; color:var(--gold-dim); margin-top: 4px;">Loading...</div>
            </div>
            <div class="date-box">
                <div class="date-label" data-i18n="loc">Location</div>
                <div class="location-val" id="location-name" style="color:var(--text-main); font-weight: bold; font-size: 1.1rem;">Detecting...</div>
            </div>
            <div class="date-box">
                <div class="date-label" data-i18n="hijri">Hijri</div>
                <div class="date-val" id="hijri-date">-- -- ----</div>
            </div>
        </section>

        <div id="sunnah-banner" class="banner">üåô <span id="sunnah-text">Sunnah Fasting Today</span></div>
        <div id="jumuah-banner" class="banner">üïå It's Jumu'ah! Remember to read Surah Al-Kahf and send Salawat.</div>

        <section id="ramadan-panel" class="card" style="display: none; border-color: var(--success); text-align: center;">
            <div id="fasting-label" style="color:var(--success); text-transform:uppercase; font-size:0.8rem; letter-spacing: 1px; width: 100%;">Fasting Timer</div>
            <div id="fasting-timer" style="font-size: clamp(1.8rem, 5vw, 2.5rem); font-family: 'Courier New', monospace; font-weight: bold; color: var(--text-main); margin-top: 5px; width: 100%;">--:--:--</div>
            <div style="font-size: 0.85rem; color: var(--gold-dim); margin-top: 15px; width: 100%;" id="ashra-label">Ashra: Mercy (Days 1-10)</div>
            <div class="progress-container" style="height: 10px; margin-top: 5px; margin-left: auto; margin-right: auto;">
                <div class="progress-bar" id="ashra-progress-fill" style="background: var(--success); width: 0%;"></div>
            </div>
            <div style="font-size: 0.75rem; color: var(--text-muted); margin-top: 8px; width: 100%; font-weight: bold;" id="ramadan-day-label">Day -- of 30</div>
        </section>

        <section class="card prayer-hero" id="hero">
            <div class="hero-main">
                <div class="date-label" id="status-label" data-i18n="curr">Current Prayer</div>
                <div class="prayer-name-display" id="curr-name">Loading...</div>
                <div id="shuruq-warning" data-i18n="nopray">* Not permissible to pray *</div>
                <div class="prayer-time-display" id="curr-time" style="font-size:1.6rem; color:var(--text-muted); font-weight: 500;">--:--</div>
                
                <div style="margin-top: 40px; width: 100%; max-width: 600px;">
                    <div class="date-label" id="next-label" data-i18n="next">Next Prayer In</div>
                    <div class="countdown-display" id="timer-display">--:--:--</div>
                    <div class="progress-container"><div class="progress-bar" id="progress-fill"></div></div>
                </div>
            </div>
            
            <div class="hero-side focus-only">
                <h3 style="color: var(--gold); margin-top: 0; font-size: 1.1rem; text-transform: uppercase; letter-spacing: 1px; border-bottom: 1px solid var(--gold-dim); padding-bottom: 10px; margin-bottom: 15px;">Today's Times</h3>
                <div id="focus-times-list" style="width: 100%; font-size: 1.1rem; display: flex; flex-direction: column; gap: 8px;"></div>
            </div>
        </section>

        <section class="card times-card" id="times-card">
            <div class="widget-title" style="display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--gold); width: 100%; margin: 0 0 15px 0; padding-bottom: 12px;">
                <button onclick="changeTrackerDate(-1)" style="background: var(--progress-bg); border: 1px solid var(--border-color); color: var(--gold); width: 35px; height: 35px; border-radius: 50%; cursor: pointer; font-weight: bold; transition: all 0.2s;" onmouseover="this.style.borderColor='var(--gold)'" onmouseout="this.style.borderColor='var(--border-color)'"><</button>
                <div style="text-align: center; line-height: 1.3;">
                    <span data-i18n="daily_times" style="font-size: 0.9rem;">Daily Prayer Times</span><br>
                    <span id="trackerDate" style="color: var(--text-main); font-size: 0.8rem; text-transform: none; font-weight: bold;">--/--/----</span>
                </div>
                <button onclick="changeTrackerDate(1)" style="background: var(--progress-bg); border: 1px solid var(--border-color); color: var(--gold); width: 35px; height: 35px; border-radius: 50%; cursor: pointer; font-weight: bold; transition: all 0.2s;" onmouseover="this.style.borderColor='var(--gold)'" onmouseout="this.style.borderColor='var(--border-color)'">></button>
            </div>
            <div id="daily-times-list" style="width: 100%; display: flex; flex-direction: column;">
                <div style="text-align: center; color: var(--text-muted); font-size: 0.95rem; padding: 20px;">Loading times...</div>
            </div>
        </section>

        <section class="card history-card" id="tracker" style="width: 100%;">
            <div style="width: 100%; border-bottom: 1px solid var(--gold); padding-bottom: 10px; margin-bottom: 20px;">
                <div class="widget-title" style="border: none; margin: 0; padding: 0; text-align: left; font-size: 1rem;" data-i18n="tracker_title">Prayer Tracker & History</div>
            </div>
            <div class="history-container">
                <div class="history-box">
                    <div id="streak-display" class="streak-badge">üî• 0 Day Streak</div>
                    
                    <p style="margin: 0 0 8px 0; font-size: 1rem;"><strong data-i18n="last_7">Last 7 Days:</strong> <span id="weekScore" style="color: var(--gold); font-weight: bold;">0</span> / <span id="weekTotal">0</span></p>
                    <div class="progress-container" style="margin-top: 5px; margin-bottom: 25px; border-color: var(--border-color); height: 10px;"><div class="progress-bar" id="weekBar" style="background: var(--success);"></div></div>
                    
                    <p style="margin: 0 0 8px 0; font-size: 1rem;"><strong data-i18n="last_30">Last 30 Days:</strong> <span id="monthScore" style="color: var(--gold); font-weight: bold;">0</span> / <span id="monthTotal">0</span></p>
                    <div class="progress-container" style="margin-top: 5px; margin-bottom: 10px; border-color: var(--border-color); height: 10px;"><div class="progress-bar" id="monthBar" style="background: var(--success);"></div></div>
                </div>

                <div class="history-box">
                    <h3 style="margin-top: 0; font-size: 1.05rem; color: var(--gold); border-bottom: 1px solid var(--border-color); padding-bottom: 12px; margin-bottom: 10px;" data-i18n="past_days">Past Days (Tap to Edit)</h3>
                    <div id="historyLog" style="max-height: 180px; overflow-y: auto; padding-right: 10px; font-size: 1rem;">
                        <div style="color: var(--text-muted); text-align: center; margin-top: 20px; font-style: italic;">Loading...</div>
                    </div>
                </div>
            </div>
        </section>

        <section class="card tasbih-card">
            <div class="widget-title" data-i18n="tasbih">Digital Tasbih</div>
            <div style="display:flex; flex-direction:column; align-items:center; justify-content: center; height: 100%; padding: 20px 0;">
                <button id="tasbih-btn" class="tasbih-circle" onclick="incrementTasbih()" aria-label="Tap to count Tasbih">0</button>
                <button onclick="resetTasbih()" style="margin-top:20px; background:var(--progress-bg); border:1px solid var(--border-color); border-radius: 20px; padding: 6px 20px; color:var(--text-muted); cursor:pointer; font-size: 0.9rem; transition: all 0.2s;" onmouseover="this.style.color='var(--gold)'; this.style.borderColor='var(--gold)';" onmouseout="this.style.color='var(--text-muted)'; this.style.borderColor='var(--border-color)';">Reset Counter</button>
            </div>
        </section>

        <section class="card qibla-card" id="qibla">
            <div class="widget-title" data-i18n="qibla">Qibla Direction</div>
            <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; flex: 1;">
                <div id="qibla-degree" style="font-size:4rem; font-weight:bold; color:var(--gold); margin: 15px 0; text-shadow: 0 2px 10px var(--shadow-color);">--¬∞</div>
                <div style="font-size:1rem; color:var(--text-muted); margin-bottom: 25px; text-transform: uppercase; letter-spacing: 1px;" data-i18n="north">from true North</div>
                <a href="https://qiblafinder.withgoogle.com/" target="_blank" class="btn-gold" data-i18n="ar_find" style="margin-top: auto;">üß≠ Open Qibla Compass</a>
            </div>
        </section>

        <article class="card text-widget">
            <div style="display: flex; justify-content: space-between; align-items: center; width: 100%; border-bottom: 1px solid var(--gold); padding-bottom: 8px; margin-bottom: 15px;">
                <span style="width: 24px;"></span>
                <span class="widget-title" id="daily-title" data-i18n="ayah" style="border: none; margin: 0; padding: 0;">Ayah of the Day</span>
                <a href="https://quran.com" target="_blank" style="text-decoration: none; font-size: 0.95rem; font-weight: bold; display: flex; align-items: center; gap: 5px; transition: transform 0.2s; color: var(--gold);" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'" title="Read on Quran.com">üìñ [Quran.com]</a>
            </div>
            <div id="daily-text" style="font-style:italic; text-align:center; color:var(--text-main); font-size: 1.15rem; line-height: 1.6; padding: 15px 0;">Loading...</div>
            <div id="daily-ref" style="color:var(--gold); font-size:0.85rem; margin-top:10px; width:100%; text-align:right; font-weight: bold;"></div>
        </article>

        <section class="card night-widget">
            <div class="widget-title" data-i18n="qiyam">Night Prayers (Qiyam)</div>
            <div style="display:flex; justify-content:space-around; width:100%; align-items: center; height: 100%;">
                <div style="text-align:center; background: var(--glass-header); padding: 20px; border-radius: 12px; border: 1px solid var(--border-color); flex: 1; margin: 0 10px;">
                    <div id="midnight-time" style="font-size:1.5rem; color:var(--gold); font-weight:bold; margin-bottom: 5px;">--:--</div>
                    <div style="font-size:0.8rem; color:var(--text-muted); text-transform: uppercase; letter-spacing: 1px;" data-i18n="mid">Midnight</div>
                </div>
                <div style="text-align:center; background: var(--glass-header); padding: 20px; border-radius: 12px; border: 1px solid var(--border-color); flex: 1; margin: 0 10px;">
                    <div id="last-third-time" style="font-size:1.5rem; color:var(--gold); font-weight:bold; margin-bottom: 5px;">--:--</div>
                    <div style="font-size:0.8rem; color:var(--text-muted); text-transform: uppercase; letter-spacing: 1px;" data-i18n="tahajjud">Tahajjud</div>
                </div>
            </div>
        </section>

        <article class="card names-widget">
            <div class="widget-title" data-i18n="allah">Name of Allah</div>
            <div style="display: flex; flex-direction: column; justify-content: center; align-items: center; flex: 1;">
                <div id="allah-ar" style="font-size:3rem; color:var(--gold); font-family: 'Tajawal', sans-serif; text-shadow: 0 2px 10px var(--shadow-color);">--</div>
                <div id="allah-en" style="font-weight:bold; color:var(--text-main); font-size: 1.3rem; margin: 10px 0; letter-spacing: 1px;">--</div>
                <div id="allah-meaning" style="font-size:0.95rem; font-style:italic; color:var(--text-muted); text-align: center; max-width: 80%;">--</div>
            </div>
        </article>

        <article class="card dua-widget">
            <div style="display: flex; justify-content: center; align-items: center; width: 100%; border-bottom: 1px solid var(--gold); padding-bottom: 8px; margin-bottom: 15px;">
                <span class="widget-title" data-i18n="dua" style="border: none; margin: 0; padding: 0;">Dua of the Day</span>
            </div>
            <div id="dua-text" style="font-style:italic; text-align:center; color:var(--text-main); font-size: 1.15rem; line-height: 1.6; padding: 15px 0;">Loading...</div>
            <div id="dua-ref" style="color:var(--gold); font-size:0.85rem; margin-top:10px; width:100%; text-align:right; font-weight: bold;"></div>
        </article>

        <article class="card ramadan-widget" id="ramadan-countdown-container">
            <div class="widget-title" data-i18n="ramadan">Ramadan Countdown</div>
            <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; flex: 1;">
                <div id="ramadan-val" style="font-size: clamp(3rem, 8vw, 4.5rem); font-weight: bold; color: var(--gold); line-height: 1; margin-bottom: 5px;">--</div>
                <div style="font-size:1rem; color:var(--text-muted); text-transform: uppercase; letter-spacing: 2px;" data-i18n="days">Days Remaining</div>
            </div>
        </article>

        <section class="card tools-card">
            <div class="widget-title" data-i18n="resources">Tools & Resources</div>
            <div style="display: flex; flex-direction: column; gap: 15px; width: 100%; justify-content: center; flex: 1;">
                <a href="https://www.myprayer.org/pages/my-prayer-book" target="_blank" class="btn-gold" style="max-width: 100%; margin: 0;">üìñ <span data-i18n="revert_guide">Step-by-Step Prayer Guide</span></a>
                <div style="display: flex; gap: 10px; width: 100%;">
                    <a href="https://apps.apple.com/us/app/namaz-app-learn-salah-prayer/id1447056625" target="_blank" class="btn-gold" style="flex: 1; max-width: 100%; font-size: 0.8rem; margin: 0;">üì± Namaz App (iOS)</a>
                    <a href="https://play.google.com/store/apps/details?id=com.nurios.namazapp" target="_blank" class="btn-gold" style="flex: 1; max-width: 100%; font-size: 0.8rem; margin: 0;">üì± Namaz App (Android)</a>
                </div>
                <a href="https://www.zakat.org/resource-center/zakat-calculator" target="_blank" class="btn-gold" style="max-width: 100%; margin: 0;">üßÆ <span data-i18n="zakat_calc">Zakat Calculator</span></a>
            </div>
        </section>

        <section class="card video-card" id="live">
            <div class="widget-title" data-i18n="live_stream">Holy Sites Live</div>
            <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; flex: 1; width: 100%;">
                <div style="display: flex; gap: 10px; margin-bottom: 20px; width: 100%;">
                    <button class="opt-btn active" id="btn-makkah" onclick="setStream('makkah')" style="flex: 1; padding: 15px;">Makkah</button>
                    <button class="opt-btn" id="btn-madinah" onclick="setStream('madinah')" style="flex: 1; padding: 15px;">Madinah</button>
                </div>
                <a id="stream-link" href="https://www.youtube.com/results?search_query=makkah+live" target="_blank" class="btn-gold" style="margin: 0;">
                    <span style="height: 10px; width: 10px; background-color: var(--danger); border-radius: 50%; display: inline-block; box-shadow: 0 0 8px var(--danger); animation: pulse 2s infinite;"></span> 
                    <span data-i18n="watch">Watch Stream</span>
                </a>
            </div>
        </section>

        <section id="install-card-section" class="card install-card" style="padding: 30px;">
            <div class="widget-title" style="margin-bottom: 15px; border: none; font-size: 1.2rem;" data-i18n="getapp">Get the App</div>
            <p style="text-align: center; color: var(--text-muted); font-size: 0.95rem; margin-top: 0; margin-bottom: 20px;">Install Adhan Display on your home screen for quick offline access.</p>
            <button id="install-btn" class="btn-gold" style="width: auto; padding: 14px 40px; border-radius: 50px; font-size: 1rem;" data-i18n="install">Install App</button>
        </section>

    </main>

    <footer>
        <img src="images/adhan display muslim prayer times dashboard logo.png" alt="Logo" class="footer-logo" style="width: 80px; height: auto; opacity: 0.8; margin-bottom: 15px; filter: drop-shadow(0 4px 10px rgba(0,0,0,0.5));">
        
        <nav class="footer-nav">
            <a href="#hero">Prayer Times</a>
            <a href="#tracker">Salah Tracker</a>
            <a href="#qibla">Qibla Compass</a>
        </nav>
        
        <p style="font-size: 0.75rem; color: var(--text-muted); margin: 15px auto; max-width: 600px; line-height: 1.5; opacity: 0.7;">
            Adhan Display is a smart Islamic dashboard and prayer tracker. Track your daily Salah offline, find the Qibla direction, and read daily Quran verses and Hadiths.
        </p>

        <p style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 15px; letter-spacing: 0.5px;">¬© 2026 Adhan Display. Serving the Ummah.</p>
        
        <a href="https://instagram.com/adhandisplay" target="_blank" style="color: var(--gold); text-decoration: none; font-size: 0.95rem; font-weight: bold; display: inline-flex; align-items: center; gap: 8px; margin-bottom: 25px; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16">
              <path d="M8 0C5.829 0 5.556.01 4.703.048 3.85.088 3.269.222 2.76.42a3.917 3.917 0 0 0-1.417.923A3.927 3.927 0 0 0 .42 2.76C.222 3.268.087 3.85.048 4.7.01 5.555 0 5.827 0 8.001c0 2.172.01 2.444.048 3.297.04.852.174 1.433.372 1.942.205.526.478.972.923 1.417.444.445.89.719 1.416.923.51.198 1.09.333 1.942.372C5.555 15.99 5.827 16 8 16s2.444-.01 3.298-.048c.851-.04 1.434-.174 1.943-.372a3.916 3.916 0 0 0 1.416-.923c.445-.445.718-.891.923-1.417.197-.509.332-1.09.372-1.942C15.99 10.445 16 10.173 16 8s-.01-2.445-.048-3.299c-.04-.851-.175-1.433-.372-1.941a3.926 3.926 0 0 0-.923-1.417A3.911 3.911 0 0 0 13.24.42c-.51-.198-1.092-.333-1.943-.372C10.443.01 10.172 0 7.998 0h.003zm-.717 1.442h.718c2.136 0 2.389.007 3.232.046.78.036 1.204.166 1.486.275.373.145.64.319.92.599.28.28.453.546.598.92.11.281.24.705.275 1.485.039.843.047 1.096.047 3.231s-.008 2.389-.047 3.232c-.035.78-.166 1.203-.275 1.485a2.47 2.47 0 0 1-.599.919c-.28.28-.546.453-.92.598-.28.11-.704.24-1.487.276-.843.038-1.096.047-3.232.047s-2.39-.009-3.233-.047c-.78-.036-1.203-.166-1.485-.276a2.478 2.478 0 0 1-.92-.598 2.48 2.48 0 0 1-.6-.92c-.109-.281-.24-.705-.275-1.485-.038-.843-.046-1.096-.046-3.233 0-2.136.008-2.388.046-3.231.036-.78.166-1.204.276-1.486.145-.373.319-.64.599-.92.28-.28.546-.453.92-.598.282-.11.705-.24 1.485-.276.738-.034 1.024-.044 2.515-.045v.002zm4.988 1.328a.96.96 0 1 0 0 1.92.96.96 0 0 0 0-1.92zm-4.27 1.122a4.109 4.109 0 1 0 0 8.217 4.109 4.109 0 0 0 0-8.217zm0 1.441a2.667 2.667 0 1 1 0 5.334 2.667 2.667 0 0 1 0-5.334z"/>
            </svg>
            @adhandisplay
        </a>
        <br>
        
        <div>
            <a href="https://buymeacoffee.com/kmni" target="_blank" style="text-decoration: none;">
                <button class="btn-gold" style="padding: 12px 30px; font-size: 0.9rem; border-radius: 50px; text-transform: none; display: inline-flex; width: auto; font-weight: bold; box-shadow: 0 4px 15px var(--shadow-color);">
                    ‚òï Donate to keep this app ad-free
                </button>
            </a>
        </div>
    </footer>

    <script>
        // FIX: Expanded i18n object to include Indonesian, Urdu, Bengali, and Russian.
        const i18n = {
            en: { subtitle: "The Ultimate Free Islamic Prayer Times & Qibla Dashboard", greg: "Gregorian", time: "Current Time", loc: "Location", hijri: "Hijri", curr: "Current Prayer", next: "Next Prayer In", ayah: "Ayah of the Day", hadith: "Hadith of the Day", dua: "Dua of the Day", qiyam: "Night Prayers", mid: "Midnight", tahajjud: "Tahajjud", allah: "Name of Allah", ramadan: "Ramadan", days: "Days Remaining", makkah: "Makkah Live", live_stream: "Holy Sites Live", watch: "Watch Stream", qibla: "Qibla Direction", north: "from true North", ar_find: "üß≠ Open Qibla Compass", getapp: "Get the App", install: "Install App", pref: "Preferences", theme: "Theme Background", dynamic: "Dynamic", size: "Text Size", lang: "Language", nopray: "* Not permissible to pray *", audio_pref: "Audio & Alerts", wudu_alert: "10-Min Wudu Alert & Push", daily_source: "Daily Inspiration", sunnah_mon: "Sunnah Fasting: Monday", sunnah_thu: "Sunnah Fasting: Thursday", sunnah_white: "Sunnah Fasting: Ayyam al-Bid (White Days)", daily_times: "Daily Prayer Times", tracker_title: "Prayer Tracker & History", last_7: "Last 7 Days:", last_30: "Last 30 Days:", past_days: "Past Days (Tap to Edit)", no_data: "No past data yet.", tasbih: "Digital Tasbih", resources: "Tools & Resources", revert_guide: "Step-by-Step Prayer Guide", zakat_calc: "Zakat Calculator" },
            tr: { subtitle: "En ƒ∞yi √úcretsiz ƒ∞slami Namaz Vakitleri Panosu", greg: "Miladi", time: "≈ûu Anki Saat", loc: "Konum", hijri: "Hicri", curr: "Mevcut Namaz", next: "Sonraki Namaz", ayah: "G√ºn√ºn Ayeti", hadith: "G√ºn√ºn Hadisi", dua: "G√ºn√ºn Duasƒ±", qiyam: "Gece Namazlarƒ±", mid: "Gece Yarƒ±sƒ±", tahajjud: "Tehecc√ºd", allah: "Allah'ƒ±n ƒ∞smi", ramadan: "Ramazan", days: "Kalan G√ºn", makkah: "Mekke Canlƒ±", live_stream: "Kutsal Yerler Canlƒ±", watch: "Yayƒ±nƒ± ƒ∞zle", qibla: "Kƒ±ble Y√∂n√º", north: "Ger√ßek Kuzeyden", ar_find: "üß≠ Kƒ±ble Pusulasƒ±nƒ± A√ß", getapp: "Uygulamayƒ± Al", install: "Uygulamayƒ± Y√ºkle", pref: "Tercihler", theme: "Tema", dynamic: "Dinamik", size: "Metin Boyutu", lang: "Dil", nopray: "* Namaz Kƒ±lmak Mekruhtur *", audio_pref: "Ses ve Uyarƒ±lar", wudu_alert: "10-Dk Abdest Uyarƒ±sƒ±", daily_source: "G√ºnl√ºk ƒ∞lham", sunnah_mon: "S√ºnnet Orucu: Pazartesi", sunnah_thu: "S√ºnnet Orucu: Per≈üembe", sunnah_white: "S√ºnnet Orucu: Eyyam-ƒ± B√Æd (Beyaz G√ºnler)", daily_times: "G√ºnl√ºk Namaz Vakitleri", tracker_title: "Namaz Takibi ve Ge√ßmi≈ü", last_7: "Son 7 G√ºn:", last_30: "Son 30 G√ºn:", past_days: "Ge√ßmi≈ü G√ºnler", no_data: "Hen√ºz veri yok.", tasbih: "Dijital Tesbih", resources: "Ara√ßlar ve Kaynaklar", revert_guide: "Adƒ±m Adƒ±m Namaz Rehberi", zakat_calc: "Zekat Hesaplayƒ±cƒ±" },
            nl: { subtitle: "Het Ultieme Islamitische Gebedstijden Dashboard", greg: "Gregoriaans", time: "Huidige Tijd", loc: "Locatie", hijri: "Hidzjra", curr: "Huidig Gebed", next: "Volgend Gebed In", ayah: "Vers van de Dag", hadith: "Hadith van de Dag", dua: "Smeekbede van de Dag", qiyam: "Nachtgebeden", mid: "Middernacht", tahajjud: "Tahajjud", allah: "Naam van Allah", ramadan: "Ramadan", days: "Dagen Te Gaan", makkah: "Mekka Live", live_stream: "Heilige Plaatsen Live", watch: "Bekijk Stream", qibla: "Qibla Richting", north: "van ware noorden", ar_find: "üß≠ Open Qibla Kompas", getapp: "Download de App", install: "Installeer App", pref: "Instellingen", theme: "Thema", dynamic: "Dynamisch", size: "Tekstgrootte", lang: "Taal", nopray: "* Bidden is niet toegestaan *", audio_pref: "Audio & Meldingen", wudu_alert: "10-Min Wudu Melding", daily_source: "Dagelijkse Inspiratie", sunnah_mon: "Sunnah Vasten: Maandag", sunnah_thu: "Sunnah Vasten: Donderdag", sunnah_white: "Sunnah Vasten: Witte Dagen", daily_times: "Dagelijkse Gebedstijden", tracker_title: "Gebedstracker & Geschiedenis", last_7: "Laatste 7 Dagen:", last_30: "Laatste 30 Dagen:", past_days: "Verleden Dagen", no_data: "Nog geen data.", tasbih: "Digitale Tasbih", resources: "Tools & Hulpbronnen", revert_guide: "Stap-voor-Stap Gebedsgids", zakat_calc: "Zakat Calculator" },
            fr: { subtitle: "Le Tableau de Bord Islamique Ultime", greg: "Gr√©gorien", time: "Heure Actuelle", loc: "Emplacement", hijri: "H√©gire", curr: "Pri√®re Actuelle", next: "Prochaine Pri√®re", ayah: "Verset du Jour", hadith: "Hadith du Jour", dua: "Dua du Jour", qiyam: "Pri√®res Nocturnes", mid: "Minuit", tahajjud: "Tahajjud", allah: "Nom d'Allah", ramadan: "Ramadan", days: "Jours Restants", makkah: "Mecque en Direct", live_stream: "Lieux Saints en Direct", watch: "Regarder le Stream", qibla: "Direction de la Qibla", north: "du vrai nord", ar_find: "üß≠ Ouvrir la Boussole Qibla", getapp: "Obtenir l'App", install: "Installer l'App", pref: "Pr√©f√©rences", theme: "Th√®me", dynamic: "Dynamique", size: "Taille du Texte", lang: "Langue", nopray: "* Pri√®re non permise *", audio_pref: "Audio & Alertes", wudu_alert: "Alerte Wudu 10-Min", daily_source: "Inspiration Quotidienne", sunnah_mon: "Je√ªne Sunnah : Lundi", sunnah_thu: "Je√ªne Sunnah : Jeudi", sunnah_white: "Je√ªne Sunnah : Jours Blancs", daily_times: "Heures de Pri√®re", tracker_title: "Suivi des Pri√®res", last_7: "7 Derniers Jours:", last_30: "30 Derniers Jours:", past_days: "Jours Pass√©s", no_data: "Aucune donn√©e.", tasbih: "Tasbih Num√©rique", resources: "Outils et Ressources", revert_guide: "Guide de Pri√®re √âtape par √âtape", zakat_calc: "Calculatrice de Zakat" },
            de: { subtitle: "Das Ultimative Islamische Dashboard", greg: "Gregorianisch", time: "Aktuelle Zeit", loc: "Ort", hijri: "Hidschra", curr: "Aktuelles Gebet", next: "N√§chstes Gebet In", ayah: "Vers des Tages", hadith: "Hadith des Tages", dua: "Dua des Tages", qiyam: "Nachtgebete", mid: "Mitternacht", tahajjud: "Tahajjud", allah: "Name Allahs", ramadan: "Ramadan", days: "Verbleibende Tage", makkah: "Mekka Live", live_stream: "Heilige St√§tten Live", watch: "Stream Ansehen", qibla: "Qibla-Richtung", north: "vom wahren Norden", ar_find: "üß≠ Qibla-Kompass √ñffnen", getapp: "App Holen", install: "App Installieren", pref: "Einstellungen", theme: "Thema", dynamic: "Dynamisch", size: "Textgr√∂√üe", lang: "Sprache", nopray: "* Beten ist nicht erlaubt *", audio_pref: "Audio & Warnungen", wudu_alert: "10-Min Wudu-Alarm", daily_source: "T√§gliche Inspiration", sunnah_mon: "Sunnah Fasten: Montag", sunnah_thu: "Sunnah Fasten: Donnerstag", sunnah_white: "Sunnah Fasten: Wei√üe Tage", daily_times: "T√§gliche Gebetszeiten", tracker_title: "Gebets-Tracker", last_7: "Letzte 7 Tage:", last_30: "Letzte 30 Tage:", past_days: "Vergangene Tage", no_data: "Noch keine Daten.", tasbih: "Digitaler Tasbih", resources: "Werkzeuge & Ressourcen", revert_guide: "Schritt-f√ºr-Schritt Gebetsanleitung", zakat_calc: "Zakat Rechner" },
            es: { subtitle: "El Panel de Oraci√≥n Isl√°mica Definitivo", greg: "Gregoriano", time: "Hora Actual", loc: "Ubicaci√≥n", hijri: "H√©gira", curr: "Oraci√≥n Actual", next: "Pr√≥xima Oraci√≥n En", ayah: "Vers√≠culo del D√≠a", hadith: "Hadiz del D√≠a", dua: "Dua del D√≠a", qiyam: "Oraciones Nocturnas", mid: "Medianoche", tahajjud: "Tahajjud", allah: "Nombre de Al√°", ramadan: "Ramad√°n", days: "D√≠as Restantes", makkah: "La Meca en Vivo", live_stream: "Lugares Santos en Vivo", watch: "Ver Transmisi√≥n", qibla: "Direcci√≥n Qibla", north: "desde el norte", ar_find: "üß≠ Abrir Br√∫jula Qibla", getapp: "Obtener App", install: "Instalar App", pref: "Preferencias", theme: "Tema", dynamic: "Din√°mico", size: "Tama√±o", lang: "Idioma", nopray: "* No est√° permitido orar *", audio_pref: "Audio y Alertas", wudu_alert: "Alerta Wudu 10-Min", daily_source: "Inspiraci√≥n Diaria", sunnah_mon: "Ayuno Sunnah: Lunes", sunnah_thu: "Ayuno Sunnah: Jueves", sunnah_white: "Ayuno Sunnah: D√≠as Blancos", daily_times: "Horarios de Oraci√≥n", tracker_title: "Rastreador de Oraciones", last_7: "√öltimos 7 D√≠as:", last_30: "√öltimos 30 D√≠as:", past_days: "D√≠as Pasados", no_data: "A√∫n no hay datos.", tasbih: "Tasbih Digital", resources: "Herramientas y Recursos", revert_guide: "Gu√≠a de Oraci√≥n Paso a Paso", zakat_calc: "Calculadora de Zakat" },
            ar: { subtitle: "ŸÑŸàÿ≠ÿ© ÿ£ŸàŸÇÿßÿ™ ÿßŸÑÿµŸÑÿßÿ© ÿßŸÑÿ•ÿ≥ŸÑÿßŸÖŸäÿ© ÿßŸÑŸÖÿ∑ŸÑŸÇÿ©", greg: "ŸÖŸäŸÑÿßÿØŸä", time: "ÿßŸÑŸàŸÇÿ™ ÿßŸÑÿ≠ÿßŸÑŸä", loc: "ÿßŸÑŸÖŸàŸÇÿπ", hijri: "Ÿáÿ¨ÿ±Ÿä", curr: "ÿßŸÑÿµŸÑÿßÿ© ÿßŸÑÿ≠ÿßŸÑŸäÿ©", next: "ÿßŸÑÿµŸÑÿßÿ© ÿßŸÑŸÇÿßÿØŸÖÿ© ŸÅŸä", ayah: "ÿ¢Ÿäÿ© ÿßŸÑŸäŸàŸÖ", hadith: "ÿ≠ÿØŸäÿ´ ÿßŸÑŸäŸàŸÖ", dua: "ÿØÿπÿßÿ° ÿßŸÑŸäŸàŸÖ", qiyam: "ŸÇŸäÿßŸÖ ÿßŸÑŸÑŸäŸÑ", mid: "ŸÖŸÜÿ™ÿµŸÅ ÿßŸÑŸÑŸäŸÑ", tahajjud: "ÿ™Ÿáÿ¨ÿØ", allah: "ÿßÿ≥ŸÖ ÿßŸÑŸÑŸá", ramadan: "ÿ±ŸÖÿ∂ÿßŸÜ", days: "ÿ£ŸäÿßŸÖ ŸÖÿ™ÿ®ŸÇŸäÿ©", makkah: "ŸÖŸÉÿ© ŸÖÿ®ÿßÿ¥ÿ±", live_stream: "ÿßŸÑÿ®ÿ´ ÿßŸÑŸÖÿ®ÿßÿ¥ÿ± ŸÑŸÑÿ£ŸÖÿßŸÉŸÜ ÿßŸÑŸÖŸÇÿØÿ≥ÿ©", watch: "ÿ¥ÿßŸáÿØ ÿßŸÑÿ®ÿ´", qibla: "ÿßÿ™ÿ¨ÿßŸá ÿßŸÑŸÇÿ®ŸÑÿ©", north: "ŸÖŸÜ ÿßŸÑÿ¥ŸÖÿßŸÑ ÿßŸÑÿ≠ŸÇŸäŸÇŸä", ar_find: "üß≠ ŸÅÿ™ÿ≠ ÿ®ŸàÿµŸÑÿ© ÿßŸÑŸÇÿ®ŸÑÿ©", getapp: "ÿßÿ≠ÿµŸÑ ÿπŸÑŸâ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ", install: "ÿ™ÿ´ÿ®Ÿäÿ™ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ", pref: "ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™", theme: "ÿßŸÑÿ≥ŸÖÿ©", dynamic: "ÿØŸäŸÜÿßŸÖŸäŸÉŸä", size: "ÿ≠ÿ¨ŸÖ ÿßŸÑŸÜÿµ", lang: "ÿßŸÑŸÑÿ∫ÿ©", nopray: "* ÿßŸÑÿµŸÑÿßÿ© ÿ∫Ÿäÿ± ÿ¨ÿßÿ¶ÿ≤ÿ© *", audio_pref: "ÿßŸÑÿµŸàÿ™ ŸàÿßŸÑÿ™ŸÜÿ®ŸäŸáÿßÿ™", wudu_alert: "ÿ™ŸÜÿ®ŸäŸá ÿßŸÑŸàÿ∂Ÿàÿ° 10 ÿØŸÇÿßÿ¶ŸÇ", daily_source: "ÿ•ŸÑŸáÿßŸÖ ŸäŸàŸÖŸä", sunnah_mon: "ÿµŸäÿßŸÖ ÿßŸÑÿ≥ŸÜÿ©: ÿßŸÑÿ•ÿ´ŸÜŸäŸÜ", sunnah_thu: "ÿµŸäÿßŸÖ ÿßŸÑÿ≥ŸÜÿ©: ÿßŸÑÿÆŸÖŸäÿ≥", sunnah_white: "ÿµŸäÿßŸÖ ÿßŸÑÿ≥ŸÜÿ©: ÿßŸÑÿ£ŸäÿßŸÖ ÿßŸÑÿ®Ÿäÿ∂", daily_times: "ŸÖŸàÿßŸÇŸäÿ™ ÿßŸÑÿµŸÑÿßÿ© ÿßŸÑŸäŸàŸÖŸäÿ©", tracker_title: "ŸÖÿ™ÿ™ÿ®ÿπ ÿßŸÑÿµŸÑÿßÿ©", last_7: "ÿ¢ÿÆÿ± 7 ÿ£ŸäÿßŸÖ:", last_30: "ÿ¢ÿÆÿ± 30 ŸäŸàŸÖ:", past_days: "ÿßŸÑÿ£ŸäÿßŸÖ ÿßŸÑŸÖÿßÿ∂Ÿäÿ©", no_data: "ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ®ŸäÿßŸÜÿßÿ™ ÿ®ÿπÿØ.", tasbih: "ŸÖÿ≥ÿ®ÿ≠ÿ© ÿ±ŸÇŸÖŸäÿ©", resources: "ÿßŸÑÿ£ÿØŸàÿßÿ™ ŸàÿßŸÑŸÖŸàÿßÿ±ÿØ", revert_guide: "ÿØŸÑŸäŸÑ ÿßŸÑÿµŸÑÿßÿ© ÿÆÿ∑Ÿàÿ© ÿ®ÿÆÿ∑Ÿàÿ©", zakat_calc: "ÿ≠ÿßÿ≥ÿ®ÿ© ÿßŸÑÿ≤ŸÉÿßÿ©" },
            id: { subtitle: "Papan Utama Waktu Shalat Islami", greg: "Masehi", time: "Waktu Saat Ini", loc: "Lokasi", hijri: "Hijriah", curr: "Shalat Saat Ini", next: "Shalat Berikutnya Dalam", ayah: "Ayat Hari Ini", hadith: "Hadits Hari Ini", dua: "Doa Hari Ini", qiyam: "Shalat Malam", mid: "Tengah Malam", tahajjud: "Tahajjud", allah: "Nama Allah", ramadan: "Ramadhan", days: "Hari Tersisa", makkah: "Makkah Live", live_stream: "Live Tempat Suci", watch: "Tonton Live", qibla: "Arah Kiblat", north: "dari Utara sebenarnya", ar_find: "üß≠ Buka Kompas Kiblat", getapp: "Dapatkan Aplikasi", install: "Instal Aplikasi", pref: "Preferensi", theme: "Tema", dynamic: "Dinamis", size: "Ukuran Teks", lang: "Bahasa", nopray: "* Dilarang shalat *", audio_pref: "Audio & Peringatan", wudu_alert: "Peringatan Wudhu 10-Menit", daily_source: "Inspirasi Harian", sunnah_mon: "Puasa Sunnah: Senin", sunnah_thu: "Puasa Sunnah: Kamis", sunnah_white: "Puasa Sunnah: Ayyamul Bidh", daily_times: "Waktu Shalat Harian", tracker_title: "Pelacak Shalat", last_7: "7 Hari Terakhir:", last_30: "30 Hari Terakhir:", past_days: "Hari Sebelumnya", no_data: "Belum ada data.", tasbih: "Tasbih Digital", resources: "Alat & Sumber Daya", revert_guide: "Panduan Shalat", zakat_calc: "Kalkulator Zakat" },
            ur: { subtitle: "ÿßÿ≥ŸÑÿßŸÖ€å ŸÜŸÖÿßÿ≤ ⁄©€í ÿßŸàŸÇÿßÿ™ ⁄©ÿß ⁄à€åÿ¥ ÿ®Ÿàÿ±⁄à", greg: "ÿπ€åÿ≥Ÿà€å", time: "ŸÖŸàÿ¨ŸàÿØ€Å ŸàŸÇÿ™", loc: "ŸÖŸÇÿßŸÖ", hijri: "€Åÿ¨ÿ±€å", curr: "ŸÖŸàÿ¨ŸàÿØ€Å ŸÜŸÖÿßÿ≤", next: "ÿß⁄ØŸÑ€å ŸÜŸÖÿßÿ≤ ŸÖ€å⁄∫", ayah: "ÿ¢ÿ¨ ⁄©€å ÿ¢€åÿ™", hadith: "ÿ¢ÿ¨ ⁄©€å ÿ≠ÿØ€åÿ´", dua: "ÿ¢ÿ¨ ⁄©€å ÿØÿπÿß", qiyam: "ŸÜŸÖÿßÿ≤ ÿ™€Åÿ¨ÿØ", mid: "ÿ¢ÿØ⁄æ€å ÿ±ÿßÿ™", tahajjud: "ÿ™€Åÿ¨ÿØ", allah: "ÿßŸÑŸÑ€Å ⁄©ÿß ŸÜÿßŸÖ", ramadan: "ÿ±ŸÖÿ∂ÿßŸÜ", days: "ÿ®ÿßŸÇ€å ÿØŸÜ", makkah: "ŸÖ⁄©€Å ŸÑÿßÿ¶€åŸà", live_stream: "ŸÖŸÇÿØÿ≥ ŸÖŸÇÿßŸÖÿßÿ™ ŸÑÿßÿ¶€åŸà", watch: "ŸÑÿßÿ¶€åŸà ÿØ€å⁄©⁄æ€å⁄∫", qibla: "ŸÇÿ®ŸÑ€Å ⁄©€å ÿ≥ŸÖÿ™", north: "ÿ≠ŸÇ€åŸÇ€å ÿ¥ŸÖÿßŸÑ ÿ≥€í", ar_find: "üß≠ ŸÇÿ®ŸÑ€Å ⁄©ŸÖŸæÿßÿ≥ ⁄©⁄æŸàŸÑ€å⁄∫", getapp: "ÿß€åŸæ ÿ≠ÿßÿµŸÑ ⁄©ÿ±€å⁄∫", install: "ÿß€åŸæ ÿßŸÜÿ≥ŸπÿßŸÑ ⁄©ÿ±€å⁄∫", pref: "ÿ™ÿ±ÿ¨€åÿ≠ÿßÿ™", theme: "ÿ™⁄æ€åŸÖ", dynamic: "ŸÖÿ™ÿ≠ÿ±⁄©", size: "ŸÖÿ™ŸÜ ⁄©ÿß ÿ≥ÿßÿ¶ÿ≤", lang: "ÿ≤ÿ®ÿßŸÜ", nopray: "* ŸÜŸÖÿßÿ≤ Ÿæ⁄ë⁄æŸÜÿß ŸÖŸÜÿπ €Å€í *", audio_pref: "ÿ¢⁄à€åŸà ÿßŸàÿ± ÿßŸÑÿ±Ÿπÿ≥", wudu_alert: "10 ŸÖŸÜŸπ Ÿàÿ∂Ÿà ÿßŸÑÿ±Ÿπ", daily_source: "ÿ±Ÿàÿ≤ÿßŸÜ€Å ⁄©€å ÿ™ÿ≠ÿ±€å⁄©", sunnah_mon: "ÿ≥ŸÜÿ™ ÿ±Ÿàÿ≤€Å: Ÿæ€åÿ±", sunnah_thu: "ÿ≥ŸÜÿ™ ÿ±Ÿàÿ≤€Å: ÿ¨ŸÖÿπÿ±ÿßÿ™", sunnah_white: "ÿ≥ŸÜÿ™ ÿ±Ÿàÿ≤€Å: ÿß€åÿßŸÖ ÿ®€åÿ∂", daily_times: "ÿ±Ÿàÿ≤ÿßŸÜ€Å ŸÜŸÖÿßÿ≤ ⁄©€í ÿßŸàŸÇÿßÿ™", tracker_title: "ŸÜŸÖÿßÿ≤ Ÿπÿ±€å⁄©ÿ±", last_7: "ÿ¢ÿÆÿ±€å 7 ÿØŸÜ:", last_30: "ÿ¢ÿÆÿ±€å 30 ÿØŸÜ:", past_days: "Ÿæ⁄Ü⁄æŸÑ€í ÿØŸÜ", no_data: "⁄©Ÿàÿ¶€å ⁄à€åŸπÿß ŸÜ€Å€å⁄∫€î", tasbih: "⁄à€åÿ¨€åŸπŸÑ ÿ™ÿ≥ÿ®€åÿ≠", resources: "ŸπŸàŸÑÿ≤ ÿßŸàÿ± Ÿàÿ≥ÿßÿ¶ŸÑ", revert_guide: "ŸÜŸÖÿßÿ≤ ⁄©ÿß ÿ∑ÿ±€åŸÇ€Å", zakat_calc: "ÿ≤⁄©ŸàŸ∞€É ⁄©€åŸÑ⁄©ŸàŸÑ€åŸπÿ±" },
            bn: { subtitle: "‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ‡¶ø‡¶ï ‡¶®‡¶æ‡¶Æ‡¶æ‡¶ú‡ßá‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°", greg: "‡¶á‡¶Ç‡¶∞‡ßá‡¶ú‡¶ø", time: "‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶∏‡¶Æ‡¶Ø‡¶º", loc: "‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶®", hijri: "‡¶π‡¶ø‡¶ú‡¶∞‡¶ø", curr: "‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶®‡¶æ‡¶Æ‡¶æ‡¶ú", next: "‡¶™‡¶∞‡¶¨‡¶∞‡ßç‡¶§‡ßÄ ‡¶®‡¶æ‡¶Æ‡¶æ‡¶ú", ayah: "‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶Ü‡¶Ø‡¶º‡¶æ‡¶§", hadith: "‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶π‡¶æ‡¶¶‡¶ø‡¶∏", dua: "‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶¶‡ßã‡¶Ø‡¶º‡¶æ", qiyam: "‡¶∞‡¶æ‡¶§‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ‡¶æ‡¶ú", mid: "‡¶Æ‡¶ß‡ßç‡¶Ø‡¶∞‡¶æ‡¶§", tahajjud: "‡¶§‡¶æ‡¶π‡¶æ‡¶ú‡ßç‡¶ú‡ßÅ‡¶¶", allah: "‡¶Ü‡¶≤‡ßç‡¶≤‡¶æ‡¶π‡¶∞ ‡¶®‡¶æ‡¶Æ", ramadan: "‡¶∞‡¶Æ‡¶ú‡¶æ‡¶®", days: "‡¶¶‡¶ø‡¶® ‡¶¨‡¶æ‡¶ï‡¶ø", makkah: "‡¶Æ‡¶ï‡ßç‡¶ï‡¶æ ‡¶≤‡¶æ‡¶á‡¶≠", live_stream: "‡¶™‡¶¨‡¶ø‡¶§‡ßç‡¶∞ ‡¶∏‡ßç‡¶•‡¶æ‡¶® ‡¶≤‡¶æ‡¶á‡¶≠", watch: "‡¶≤‡¶æ‡¶á‡¶≠ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®", qibla: "‡¶ï‡¶ø‡¶¨‡¶≤‡¶æ‡¶∞ ‡¶¶‡¶ø‡¶ï", north: "‡¶™‡ßç‡¶∞‡¶ï‡ßÉ‡¶§ ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶•‡ßá‡¶ï‡ßá", ar_find: "üß≠ ‡¶ï‡¶ø‡¶¨‡¶≤‡¶æ ‡¶ï‡¶Æ‡ßç‡¶™‡¶æ‡¶∏ ‡¶ñ‡ßÅ‡¶≤‡ßÅ‡¶®", getapp: "‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡¶ü‡¶ø ‡¶™‡¶æ‡¶®", install: "‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶á‡¶®‡¶∏‡ßç‡¶ü‡¶≤ ‡¶ï‡¶∞‡ßÅ‡¶®", pref: "‡¶™‡¶õ‡¶®‡ßç‡¶¶‡¶∏‡¶Æ‡ßÇ‡¶π", theme: "‡¶•‡¶ø‡¶Æ", dynamic: "‡¶°‡¶æ‡¶á‡¶®‡¶æ‡¶Æ‡¶ø‡¶ï", size: "‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‡¶∏‡¶æ‡¶á‡¶ú", lang: "‡¶≠‡¶æ‡¶∑‡¶æ", nopray: "* ‡¶®‡¶æ‡¶Æ‡¶æ‡¶ú ‡¶™‡¶°‡¶º‡¶æ ‡¶®‡¶ø‡¶∑‡ßá‡¶ß *", audio_pref: "‡¶Ö‡¶°‡¶ø‡¶ì ‡¶è‡¶¨‡¶Ç ‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ", wudu_alert: "‡ßß‡ß¶-‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü ‡¶ì‡¶ú‡ßÅ ‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ", daily_source: "‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶Ö‡¶®‡ßÅ‡¶™‡ßç‡¶∞‡ßá‡¶∞‡¶£‡¶æ", sunnah_mon: "‡¶∏‡ßÅ‡¶®‡ßç‡¶®‡¶æ‡¶π ‡¶∞‡ßã‡¶ú‡¶æ: ‡¶∏‡ßã‡¶Æ‡¶¨‡¶æ‡¶∞", sunnah_thu: "‡¶∏‡ßÅ‡¶®‡ßç‡¶®‡¶æ‡¶π ‡¶∞‡ßã‡¶ú‡¶æ: ‡¶¨‡ßÉ‡¶π‡¶∏‡ßç‡¶™‡¶§‡¶ø‡¶¨‡¶æ‡¶∞", sunnah_white: "‡¶∏‡ßÅ‡¶®‡ßç‡¶®‡¶æ‡¶π ‡¶∞‡ßã‡¶ú‡¶æ: ‡¶Ü‡¶á‡¶Ø‡¶º‡¶æ‡¶Æ‡ßá ‡¶¨‡¶ø‡¶ú", daily_times: "‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶®‡¶æ‡¶Æ‡¶æ‡¶ú‡ßá‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º", tracker_title: "‡¶®‡¶æ‡¶Æ‡¶æ‡¶ú ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶∞", last_7: "‡¶∂‡ßá‡¶∑ ‡ß≠ ‡¶¶‡¶ø‡¶®:", last_30: "‡¶∂‡ßá‡¶∑ ‡ß©‡ß¶ ‡¶¶‡¶ø‡¶®:", past_days: "‡¶Ö‡¶§‡ßÄ‡¶§‡ßá‡¶∞ ‡¶¶‡¶ø‡¶®‡¶ó‡ßÅ‡¶≤‡ßã", no_data: "‡¶ï‡ßã‡¶®‡ßã ‡¶°‡ßá‡¶ü‡¶æ ‡¶®‡ßá‡¶á‡•§", tasbih: "‡¶°‡¶ø‡¶ú‡¶ø‡¶ü‡¶æ‡¶≤ ‡¶§‡¶∏‡¶¨‡¶ø‡¶π", resources: "‡¶ü‡ßÅ‡¶≤‡¶∏ ‡¶è‡¶¨‡¶Ç ‡¶∞‡¶ø‡¶∏‡ßã‡¶∞‡ßç‡¶∏", revert_guide: "‡¶®‡¶æ‡¶Æ‡¶æ‡¶ú ‡¶™‡¶°‡¶º‡¶æ‡¶∞ ‡¶®‡¶ø‡¶Ø‡¶º‡¶Æ", zakat_calc: "‡¶Ø‡¶æ‡¶ï‡¶æ‡¶§ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤‡¶ï‡ßÅ‡¶≤‡ßá‡¶ü‡¶∞" },
            ru: { subtitle: "–ò—Å–ª–∞–º—Å–∫–∞—è –ø–∞–Ω–µ–ª—å –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞–º–∞–∑–∞", greg: "–ì—Ä–∏–≥–æ—Ä–∏–∞–Ω—Å–∫–∏–π", time: "–¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è", loc: "–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ", hijri: "–•–∏–¥–∂—Ä–∞", curr: "–¢–µ–∫—É—â–∏–π –Ω–∞–º–∞–∑", next: "–°–ª–µ–¥—É—é—â–∏–π –Ω–∞–º–∞–∑ —á–µ—Ä–µ–∑", ayah: "–ê—è—Ç –¥–Ω—è", hadith: "–•–∞–¥–∏—Å –¥–Ω—è", dua: "–î—É–∞ –¥–Ω—è", qiyam: "–ù–æ—á–Ω—ã–µ –º–æ–ª–∏—Ç–≤—ã", mid: "–ü–æ–ª–Ω–æ—á—å", tahajjud: "–¢–∞—Ö–∞–¥–∂—É–¥", allah: "–ò–º—è –ê–ª–ª–∞—Ö–∞", ramadan: "–†–∞–º–∞–¥–∞–Ω", days: "–û—Å—Ç–∞–ª–æ—Å—å –¥–Ω–µ–π", makkah: "–ú–µ–∫–∫–∞ –ü—Ä—è–º–æ–π —ç—Ñ–∏—Ä", live_stream: "–°–≤—è—Ç—ã–µ –º–µ—Å—Ç–∞ (—ç—Ñ–∏—Ä)", watch: "–°–º–æ—Ç—Ä–µ—Ç—å —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—é", qibla: "–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ö–∏–±–ª—ã", north: "–æ—Ç –∏—Å—Ç–∏–Ω–Ω–æ–≥–æ —Å–µ–≤–µ—Ä–∞", ar_find: "üß≠ –û—Ç–∫—Ä—ã—Ç—å –∫–æ–º–ø–∞—Å –ö–∏–±–ª—ã", getapp: "–°–∫–∞—á–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ", install: "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ", pref: "–ù–∞—Å—Ç—Ä–æ–π–∫–∏", theme: "–¢–µ–º–∞", dynamic: "–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è", size: "–†–∞–∑–º–µ—Ä —Ç–µ–∫—Å—Ç–∞", lang: "–Ø–∑—ã–∫", nopray: "* –ú–æ–ª–∏—Ç—å—Å—è –Ω–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ *", audio_pref: "–ê—É–¥–∏–æ –∏ –æ–ø–æ–≤–µ—â–µ–Ω–∏—è", wudu_alert: "10-–º–∏–Ω –æ–ø–æ–≤–µ—â–µ–Ω–∏–µ –æ –≤—É–¥—É", daily_source: "–ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ", sunnah_mon: "–°—É–Ω–Ω–∞-–ø–æ—Å—Ç: –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫", sunnah_thu: "–°—É–Ω–Ω–∞-–ø–æ—Å—Ç: –ß–µ—Ç–≤–µ—Ä–≥", sunnah_white: "–°—É–Ω–Ω–∞-–ø–æ—Å—Ç: –ë–µ–ª—ã–µ –¥–Ω–∏", daily_times: "–ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –≤—Ä–µ–º—è –Ω–∞–º–∞–∑–∞", tracker_title: "–¢—Ä–µ–∫–µ—Ä –Ω–∞–º–∞–∑–∞", last_7: "–ü–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π:", last_30: "–ü–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π:", past_days: "–ü—Ä–æ—à–ª—ã–µ –¥–Ω–∏", no_data: "–ü–æ–∫–∞ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö.", tasbih: "–¶–∏—Ñ—Ä–æ–≤–æ–π —Ç–∞—Å–±–∏—Ö", resources: "–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏ —Ä–µ—Å—É—Ä—Å—ã", revert_guide: "–ü–æ—à–∞–≥–æ–≤–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ", zakat_calc: "–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∑–∞–∫—è—Ç–∞" }
        };

        const dailyHadiths = [
            { text: "Actions are according to intentions, and everyone will get what was intended.", ref: "Sahih al-Bukhari 1" },
            { text: "He who does not show mercy to people, Allah will not show mercy to him.", ref: "Sahih Muslim 2319" },
            { text: "Make things easy for the people, and do not make it difficult for them.", ref: "Sahih al-Bukhari 69" },
            { text: "A good word is charity.", ref: "Sahih al-Bukhari 2989" },
            { text: "Richness is not having many possessions, but richness is being content with oneself.", ref: "Sahih al-Bukhari 6446" },
            { text: "None of you truly believes until he loves for his brother what he loves for himself.", ref: "Sahih al-Bukhari 13" },
            { text: "The strong man is not the good wrestler, but the strong man is he who controls himself when he is angry.", ref: "Sahih al-Bukhari 6114" },
            { text: "Every religion has its distinct characteristic, and the distinct characteristic of Islam is modesty.", ref: "Ibn Majah 4181" },
            { text: "The most beloved of deeds to Allah are those that are most consistent, even if it is small.", ref: "Sahih al-Bukhari 6464" },
            { text: "Do not belittle any good deed, even meeting your brother with a cheerful face.", ref: "Sahih Muslim 2626" },
            { text: "The best among you are those who have the best manners and character.", ref: "Sahih al-Bukhari 6029" },
            { text: "Whoever believes in Allah and the Last Day should speak a good word or remain silent.", ref: "Sahih al-Bukhari 6018" },
            { text: "God is gentle and loves gentleness in all things.", ref: "Sahih al-Bukhari 6024" },
            { text: "A believer is not a fault-finder, a curser, an abuser, or a foul-mouthed person.", ref: "Jami` at-Tirmidhi 1977" },
            { text: "Seek knowledge from the cradle to the grave.", ref: "Islamic Proverb" },
            { text: "The believer‚Äôs shade on the Day of Resurrection will be his charity.", ref: "Jami` at-Tirmidhi 1925" },
            { text: "Part of the perfection of a person's Islam is leaving what does not concern him.", ref: "Jami` at-Tirmidhi 2317" },
            { text: "Allah does not look at your forms and possessions, but He looks at your hearts and your deeds.", ref: "Sahih Muslim 2564" },
            { text: "When a man dies, his deeds come to an end except for three: ongoing charity, beneficial knowledge, or a righteous child who prays for him.", ref: "Sahih Muslim 1631" },
            { text: "The best of you are those who learn the Quran and teach it.", ref: "Sahih al-Bukhari 5027" },
            { text: "Purity is half of faith.", ref: "Sahih Muslim 223" },
            { text: "There is no disease that Allah has created, except that He also has created its treatment.", ref: "Sahih al-Bukhari 5678" },
            { text: "The upper hand is better than the lower hand (i.e. he who gives is better than he who takes).", ref: "Sahih al-Bukhari 1429" },
            { text: "Modesty brings nothing but good.", ref: "Sahih al-Bukhari 6117" },
            { text: "He who cheats us is not one of us.", ref: "Sahih Muslim 101" },
            { text: "Take advantage of five before five: your youth before your old age, your health before your illness, your wealth before your poverty, your free time before your preoccupation, and your life before your death.", ref: "Shu'ab al-Iman" },
            { text: "Whoever relieves a believer‚Äôs distress of the distressful aspects of this world, Allah will rescue him from a difficulty of the difficulties of the Hereafter.", ref: "Sahih Muslim 2699" },
            { text: "A father gives his child nothing better than a good education.", ref: "Jami` at-Tirmidhi 1952" },
            { text: "Hell lies hidden behind evil desires, and Paradise lies hidden behind hardships.", ref: "Sahih al-Bukhari 6487" },
            { text: "Feed the hungry, visit the sick, and set free the captives.", ref: "Sahih al-Bukhari 5373" },
            { text: "By Allah, he does not believe! By Allah, he does not believe! By Allah, he does not believe! ... He whose neighbor is not safe from his evil.", ref: "Sahih al-Bukhari 6016" },
            { text: "The most perfect believer in faith is the one whose character is finest and who is kindest to his wife.", ref: "Jami` at-Tirmidhi 2612" },
            { text: "Whoever directs someone to a good, then he will have the reward equal to the doer of the action.", ref: "Sahih Muslim 1893" },
            { text: "Give the worker his wages before his sweat dries.", ref: "Sunan Ibn Majah 2443" },
            { text: "No companion of mine should tell me anything bad about another person.", ref: "Sunan Abi Dawud" },
            { text: "The true Muslim is the one from whose tongue and hands the Muslims are safe.", ref: "Sahih al-Bukhari 10" },
            { text: "Beware of suspicion, for suspicion is the worst of false tales.", ref: "Sahih al-Bukhari 6064" },
            { text: "Look at those who stand at a lower level than you but don't look at those who stand at a higher level than you, for this would make the favors conferred upon you by Allah insignificant in your eyes.", ref: "Sahih Muslim 2963" },
            { text: "Allah is Beautiful, He loves beauty.", ref: "Sahih Muslim 91" },
            { text: "Truthfulness leads to righteousness, and righteousness leads to Paradise.", ref: "Sahih al-Bukhari 6094" },
            { text: "A man follows the religion of his friend; so each one should consider whom he makes his friend.", ref: "Sunan Abi Dawud 4833" },
            { text: "The merciful will be shown mercy by the Most Merciful. Be merciful to those on the earth, and the One in the heavens will have mercy upon you.", ref: "Jami` at-Tirmidhi 1924" },
            { text: "Oppression will be a darkness on the Day of Resurrection.", ref: "Sahih al-Bukhari 2447" },
            { text: "Do not be people without minds of your own, saying that if others treat you well you will treat them well, and that if they do wrong you will do wrong.", ref: "Jami` at-Tirmidhi 2007" },
            { text: "Verily, Allah does not look to your faces and your wealth but He looks to your heart and to your deeds.", ref: "Sahih Muslim 2564" },
            { text: "If you guarantee me six things on your part I shall guarantee you Paradise : Speak the truth when you talk, keep a promise when you make it...", ref: "Musnad Ahmad" },
            { text: "Every act of goodness is charity.", ref: "Sahih Muslim 1005" },
            { text: "A person will be with those whom he loves.", ref: "Sahih al-Bukhari 6168" },
            { text: "The world is a prison for the believer and a paradise for the unbeliever.", ref: "Sahih Muslim 2956" },
            { text: "He who covers the faults of a Muslim, Allah will cover his faults in this world and the Hereafter.", ref: "Sahih Muslim 2699" },
            { text: "There is no reward for a Hajj Mabrur except Paradise.", ref: "Sahih al-Bukhari 1773" },
            { text: "The key to Paradise is Salah (prayer).", ref: "Jami` at-Tirmidhi 4" },
            { text: "O Allah, I seek refuge in You from anxiety and sorrow, weakness and laziness, miserliness and cowardice.", ref: "Sahih al-Bukhari 2893" },
            { text: "Do not sever relations. Do not turn your backs on each other. Do not entertain mutual hatred.", ref: "Sahih Muslim 2559" },
            { text: "When you see a person who has been given more than you in money and beauty, look to those who have been given less.", ref: "Sahih Muslim" },
            { text: "The greatest jihad is to battle your own soul, to fight the evil within yourself.", ref: "Ibn Majah" },
            { text: "Do not wish to be like anyone except in two cases: a man whom Allah has given wealth and he spends it righteously...", ref: "Sahih al-Bukhari 73" },
            { text: "Smiling at your brother is charity.", ref: "Tirmidhi" },
            { text: "Be mindful of Allah, you will find Him before you.", ref: "40 Hadith Nawawi 19" },
            { text: "Say, 'I believe in Allah' and then be steadfast.", ref: "Sahih Muslim 38" },
            { text: "When three of you are together, two of you must not converse privately ignoring the third.", ref: "Sahih Muslim 2183" },
            { text: "He is not a believer whose stomach is filled while the neighbor to his side goes hungry.", ref: "Sunan al-Kubra 19049" },
            { text: "Make things easy, and do not make them difficult. Give glad tidings, and do not put people off.", ref: "Sahih al-Bukhari 6125" },
            { text: "Whoever does not thank people has not thanked Allah.", ref: "Sunan Abi Dawud 4811" },
            { text: "Exchange gifts, as that will lead to increasing your love to one another.", ref: "Al-Adab Al-Mufrad 594" },
            { text: "Allah is mild and is fond of mildness, and He gives to the mild what he does not give to the harsh.", ref: "Sahih Muslim 2593" },
            { text: "He who traverses a path in search of knowledge, Allah will make easy for him the path to Paradise.", ref: "Sahih Muslim 2699" },
            { text: "The best wealth is a tongue that remembers Allah, a grateful heart, and a believing wife.", ref: "Sunan Ibn Majah 1856" },
            { text: "Keep away from envy, for it eats up good deeds just as fire eats up firewood.", ref: "Sunan Abi Dawud 4903" },
            { text: "A believer is simple and noble, while an evildoer is deceitful and ignoble.", ref: "Sunan Abi Dawud 4790" },
            { text: "No one has ever eaten better food than what he eats from the work done by his own hands.", ref: "Sahih al-Bukhari 2072" },
            { text: "The most beloved places to Allah are the mosques.", ref: "Sahih Muslim 671" },
            { text: "Seven people will be shaded by Allah under His shade on the day when there will be no shade except His...", ref: "Sahih al-Bukhari 660" },
            { text: "You will not enter Paradise until you believe, and you will not believe until you love one another.", ref: "Sahih Muslim 54" },
            { text: "Righteousness is good character.", ref: "Sahih Muslim 2553" },
            { text: "If the Hour (the day of Resurrection) is about to be established and one of you was holding a palm shoot, let him take advantage of even one second before the Hour is established to plant it.", ref: "Musnad Ahmad 12902" },
            { text: "Leave that which makes you doubt for that which does not make you doubt.", ref: "Jami` at-Tirmidhi 2518" },
            { text: "Do not let yourselves be 'yes-men', saying: 'If the people are good then we will be good, and if they are wrong then we will be wrong.'", ref: "Jami` at-Tirmidhi 2007" },
            { text: "Do not be angry, and Paradise will be yours.", ref: "Tabarani" },
            { text: "The strong man is he who controls himself when he is angry.", ref: "Sahih al-Bukhari 6114" },
            { text: "No fatigue, nor disease, nor sorrow, nor sadness, nor hurt, nor distress befalls a Muslim, even if it were the prick he receives from a thorn, but that Allah expiates some of his sins for that.", ref: "Sahih al-Bukhari 5641" },
            { text: "Whoever reads a letter from the Book of Allah, he will have a reward. And that reward will be multiplied by ten.", ref: "Jami` at-Tirmidhi 2910" },
            { text: "The supplication of a Muslim for his brother in his absence will certainly be answered.", ref: "Sahih Muslim 2732" },
            { text: "He who has in his heart the weight of a mustard seed of pride shall not enter Paradise.", ref: "Sahih Muslim 91" },
            { text: "The best among you are those who are best to their families.", ref: "Jami` at-Tirmidhi 3895" },
            { text: "Cleanliness is half of faith.", ref: "Sahih Muslim 223" },
            { text: "If anyone constantly seeks pardon (from Allah), Allah will appoint for him a way out of every distress.", ref: "Sunan Abi Dawud 1518" },
            { text: "Do not invoke curses on yourselves or on your children or on your possessions.", ref: "Sahih Muslim 3009" },
            { text: "A believer is friendly and sociable. There is no good in one who is neither friendly nor sociable.", ref: "Musnad Ahmad 9187" },
            { text: "He who keeps silent saves himself.", ref: "Jami` at-Tirmidhi 2501" },
            { text: "Be in this world as if you were a stranger or a traveler.", ref: "Sahih al-Bukhari 6416" },
            { text: "Verily, the religion is easy, and no one burdens himself in religion except that it overcomes him.", ref: "Sahih al-Bukhari 39" },
            { text: "The signs of a hypocrite are three: When he speaks, he lies; when he makes a promise, he breaks it; and when he is trusted, he betrays his trust.", ref: "Sahih al-Bukhari 33" },
            { text: "When you stand up for your prayer, pray as if it is your last prayer.", ref: "Sunan Ibn Majah 4171" },
            { text: "Fasting is a shield.", ref: "Sahih al-Bukhari 1894" },
            { text: "Whoever does not show mercy to our young ones, nor acknowledge the right of our elders, is not one of us.", ref: "Jami` at-Tirmidhi 1919" },
            { text: "Whoever covers (the faults of) a Muslim, Allah will cover his faults on the Day of Resurrection.", ref: "Sahih al-Bukhari 2442" },
            { text: "A person's true wealth is the good he does in this world to his fellow men.", ref: "Islamic Proverb" },
            { text: "The best giving is that which is given from the heart.", ref: "Islamic Proverb" },
            { text: "Speak good or remain silent.", ref: "Sahih al-Bukhari 6018" }
        ];

        const dailyDuas = [
            { text: "Rabbana atina fid-dunya hasanatan wa fil 'akhirati hasanatan waqina 'adhaban-nar\n(Our Lord, give us in this world [that which is] good and in the Hereafter [that which is] good and protect us from the punishment of the Fire.)", ref: "Quran 2:201" },
            { text: "Rabbi inni lima anzalta ilayya min khayrin faqir\n(My Lord, indeed I am, for whatever good You would send down to me, in need.)", ref: "Quran 28:24" },
            { text: "Ya Muqallibal-qulub, thabbit qalbi 'ala dinik\n(O Turner of the hearts, keep my heart firm upon Your religion.)", ref: "Tirmidhi" },
            { text: "Rabbi zidni 'ilma\n(My Lord, increase me in knowledge.)", ref: "Quran 20:114" },
            { text: "Astaghfirullahal-ladhi la ilaha illa Huwal-Hayyul-Qayyum wa atubu ilayh\n(I seek the forgiveness of Allah, there is no true god except Him, the Ever-Living, the Sustainer of existence, and I turn to Him in repentance.)", ref: "Tirmidhi" },
            { text: "Rabbighfir warham wa anta khayrur-rahimin\n(My Lord, forgive and have mercy, and You are the best of the merciful.)", ref: "Quran 23:118" },
            { text: "Rabbana la tuzigh qulubana ba'da idh hadaytana wa hab lana min ladunka rahmatan\n(Our Lord, let not our hearts deviate after You have guided us and grant us from Yourself mercy.)", ref: "Quran 3:8" },
            { text: "Rabbana hab lana min azwajina wa dhurriyyatina qurrata a'yunin waj'alna lil-muttaqina imama\n(Our Lord, grant us from among our wives and offspring comfort to our eyes and make us an example for the righteous.)", ref: "Quran 25:74" },
            { text: "Rabbana zalamna anfusana wa in lam taghfir lana wa tarhamna lanakunanna minal-khasirin\n(Our Lord, we have wronged ourselves, and if You do not forgive us and have mercy upon us, we will surely be among the losers.)", ref: "Quran 7:23" },
            { text: "Rabbi ishrah li sadri wa yassir li amri\n(My Lord, expand for me my breast [with assurance] and ease for me my task.)", ref: "Quran 20:25-26" },
            { text: "Rabbana afrigh 'alayna sabran wa thabbit aqdamana wansurna 'alal-qawmil-kafirin\n(Our Lord, pour upon us patience and plant firmly our feet and give us victory over the disbelieving people.)", ref: "Quran 2:250" },
            { text: "Rabbi awzi'ni an ashkura ni'matakal-lati an'amta 'alayya wa 'ala walidayya\n(My Lord, enable me to be grateful for Your favor which You have bestowed upon me and upon my parents.)", ref: "Quran 27:19" },
            { text: "Rabbi hab li min ladunka dhurriyyatan tayyibatan innaka sami'ud-du'a\n(My Lord, grant me from Yourself a good offspring. Indeed, You are the Hearer of supplication.)", ref: "Quran 3:38" },
            { text: "Rabbana-ghfir lana wa li-ikhwaninal-ladhina sabaquna bil-iman\n(Our Lord, forgive us and our brothers who preceded us in faith.)", ref: "Quran 59:10" },
            { text: "Rabbi-j'alni muqimas-salati wa min dhurriyyati Rabbana wa taqabbal du'a\n(My Lord, make me an establisher of prayer, and [many] from my descendants. Our Lord, and accept my supplication.)", ref: "Quran 14:40" },
            { text: "Rabbana taqabbal minna innaka Antas-Sami'ul-'Alim\n(Our Lord, accept [this] from us. Indeed You are the Hearing, the Knowing.)", ref: "Quran 2:127" },
            { text: "Hasbunallah wa ni'mal-wakil\n(Sufficient for us is Allah, and [He is] the best Disposer of affairs.)", ref: "Quran 3:173" },
            { text: "La ilaha illa anta subhanaka inni kuntu minaz-zalimin\n(There is no deity except You; exalted are You. Indeed, I have been of the wrongdoers.)", ref: "Quran 21:87" },
            { text: "Bismillahil-ladhi la yadurru ma'as-mihi shai'un fil-ardi wa la fis-sama'i wa huwas-Sami'ul-'Alim\n(In the Name of Allah with Whose Name there is protection against every kind of harm in the earth or in the heaven, and He is the All-Hearing and All-Knowing.)", ref: "Abu Dawud" },
            { text: "Raditu billahi Rabban wa bil-Islami dinan wa bi Muhammadin nabiyyan\n(I am pleased with Allah as my Lord, with Islam as my religion, and with Muhammad as my Prophet.)", ref: "Abu Dawud" },
            { text: "Allahumma inni as'alukal-huda wat-tuqa wal-'afafa wal-ghina\n(O Allah, I ask You for guidance, piety, chastity, and self-sufficiency.)", ref: "Muslim" },
            { text: "Allahumma inni a'udhu bika minal-hammi wal-hazan, wal-'ajzi wal-kasal, wal-bukhli wal-jubn\n(O Allah, I seek refuge in You from anxiety and sorrow, weakness and laziness, miserliness and cowardice.)", ref: "Bukhari" },
            { text: "Allahumma 'afini fi badani, Allahumma 'afini fi sam'i, Allahumma 'afini fi basari\n(O Allah, grant me health in my body. O Allah, grant me health in my hearing. O Allah, grant me health in my sight.)", ref: "Abu Dawud" },
            { text: "Allahumma inni as'aluka 'ilman nafi'an, wa rizqan tayyiban, wa 'amalan mutaqabbalan\n(O Allah, I ask You for beneficial knowledge, goodly provision, and acceptable deeds.)", ref: "Ibn Majah" },
            { text: "Ya Hayyu Ya Qayyum, bi-rahmatika astaghith, aslih li sha'ni kullahu\n(O Ever-Living, O Sustainer, in Your mercy I seek relief; rectify for me all of my affairs.)", ref: "Tirmidhi" },
            { text: "Allahumma rahmataka arju fala takilni ila nafsi tarfata 'aynin\n(O Allah, it is Your mercy that I hope for, so do not leave me in charge of my affairs even for a blink of an eye.)", ref: "Abu Dawud" },
            { text: "Allahumma ajirni minan-nar\n(O Allah, save me from the Fire.)", ref: "Abu Dawud" },
            { text: "Allahumma innaka 'afuwwun tuhibbul-'afwa fa'fu 'anni\n(O Allah, You are forgiving and love forgiveness, so forgive me.)", ref: "Tirmidhi" },
            { text: "Rabbi-ghfir li wa tub 'alayya innaka Antat-Tawwabur-Rahim\n(My Lord, forgive me and accept my repentance. Indeed, You are the Accepting of repentance, the Merciful.)", ref: "Abu Dawud" },
            { text: "Allahummaghfir li dhanbi kullahu, diqqahu wa jillahu, wa awwalahu wa akhirahu\n(O Allah, forgive me all my sins, the small and the great, the first and the last.)", ref: "Muslim" },
            { text: "Allahumma inni a'udhu bika min 'adhabi jahannam wa min 'adhabil-qabri\n(O Allah, I seek refuge in You from the punishment of Hell and from the punishment of the grave.)", ref: "Muslim" },
            { text: "Allahumma bika asbahna wa bika amsayna, wa bika nahya wa bika namut, wa ilaykan-nushur\n(O Allah, by You we enter the morning and by You we enter the evening, by You we live and by You we die, and to You is the Final Return.)", ref: "Tirmidhi" },
            { text: "Allahumma anta Rabbi la ilaha illa anta, khalaqtani wa ana 'abduka...\n(O Allah, You are my Lord, there is none worthy of worship but You. You created me and I am Your slave...)", ref: "Sayyid al-Istighfar (Bukhari)" },
            { text: "Subhanallahi wa bihamdihi, Subhanallahil-'Azim\n(Glory be to Allah and His is the praise, (and) Allah, the Greatest is free from imperfection.)", ref: "Bukhari" },
            { text: "La hawla wa la quwwata illa billah\n(There is no power and no strength except with Allah.)", ref: "Bukhari" },
            { text: "Allahumm-aslih li dini alladhi huwa 'ismatu amri, wa aslih li dunyaya allati fiha ma'ashi\n(O Allah, set right for me my religion which is the safeguard of my affairs. And set right for me my world in which is my life.)", ref: "Muslim" },
            { text: "Allahumma inni as'alukal-'afwa wal-'afiyata fid-dunya wal-akhirah\n(O Allah, I ask You for forgiveness and well-being in this world and in the Hereafter.)", ref: "Abu Dawud" },
            { text: "Allahumma a'inni 'ala dhikrika wa shukrika wa husni 'ibadatik\n(O Allah, help me to remember You, to thank You, and to worship You in the best of manners.)", ref: "Abu Dawud" },
            { text: "Rabbana atina min ladunka rahmatan wahayyi' lana min amrina rashada\n(Our Lord, grant us from Yourself mercy and prepare for us from our affair right guidance.)", ref: "Quran 18:10" },
            { text: "Rabbi fala taj'alni fil-qawmiz-zalimin\n(My Lord, then do not place me among the wrongdoing people.)", ref: "Quran 23:94" },
            { text: "Rabbana wasi'ta kulla shai'in rahmatan wa 'ilman faghfir lilladhina tabu\n(Our Lord, You have encompassed all things in mercy and knowledge, so forgive those who have repented.)", ref: "Quran 40:7" },
            { text: "Rabbana-ghfir lana dhunubana wa israfana fi amrina wa thabbit aqdamana\n(Our Lord, forgive us our sins and the excess [committed] in our affairs and plant firmly our feet.)", ref: "Quran 3:147" },
            { text: "Rabbi anilni hukman wa alhiqni bis-salihin\n(My Lord, grant me authority and join me with the righteous.)", ref: "Quran 26:83" },
            { text: "Rabbana asrif 'anna 'adhaba jahannama inna 'adhabaha kana gharama\n(Our Lord, avert from us the punishment of Hell. Indeed, its punishment is ever adhering.)", ref: "Quran 25:65" },
            { text: "Allahumma musarrifal-qulub, sarrif qulubana 'ala ta'atik\n(O Allah, Turner of the hearts, direct our hearts to Your obedience.)", ref: "Muslim" },
            { text: "Allahumma inni a'udhu bika min zawali ni'matik, wa tahawwuli 'afiyatik\n(O Allah, I seek refuge in You from the withholding of Your favor, the decline of the good health You have given.)", ref: "Muslim" },
            { text: "Allahumma aslih dhati baynina wa allif bayna qulubina wahdina subulas-salam\n(O Allah, reconcile between us, bring our hearts together, and guide us to the paths of peace.)", ref: "Abu Dawud" },
            { text: "Allahumm-akfini bihalalika 'an haramika wa aghnini bifadlika 'amman siwaka\n(O Allah, suffice me with Your lawful against Your unlawful, and make me independent of all those besides You.)", ref: "Tirmidhi" },
            { text: "Allahumma inni as'aluka husnal-khatimah\n(O Allah, I ask You for a good end to my life.)", ref: "General Dua" },
            { text: "Allahumma ij'al fi qalbi nuran wa fi basari nuran wa fi sam'i nuran\n(O Allah, place light in my heart, and light in my sight, and light in my hearing.)", ref: "Muslim" }
        ];

        let config = { lat: 52.0907, lon: 5.1214, city: 'Netherlands', method: 3, offset: 0, hijriOffset: 0 };
        let state = { prayers: {}, monthlyCache: [], nextPrayer: null, prevPrayerTime: null, namesList: [], isRamadan: false, notified10Min: false, adhanPlayed: false, dailyAlertTriggered: false, qiblaDegree: 0 };
        let wakeLock = null;
        let isAutoLoc = localStorage.getItem('adhan_auto_loc') !== 'false';
        let autoLocationInterval = null;

        const DOM = {};

        async function requestWakeLock() {
            if ('wakeLock' in navigator) {
                try {
                    wakeLock = await navigator.wakeLock.request('screen');
                    wakeLock.addEventListener('release', () => { console.log('Screen Wake Lock released'); });
                } catch (err) { console.error(`${err.name}, ${err.message}`); }
            }
        }
        document.addEventListener('visibilitychange', async () => { if (document.visibilityState === 'visible') requestWakeLock(); });

        function checkOnboarding() {
            if (!localStorage.getItem('adhan_onboarded')) {
                document.getElementById('onboarding-modal').classList.add('active');
            } else {
                applyGreeting();
            }
        }

        window.finishOnboarding = function(saveData) {
            if (saveData) {
                const name = document.getElementById('ob-name').value.trim();
                const year = document.getElementById('ob-year').value;
                const gender = document.getElementById('ob-gender').value;
                const bg = document.getElementById('ob-bg').value;

                if (name) localStorage.setItem('adhan_user_name', name);
                if (year) localStorage.setItem('adhan_user_year', year);
                if (gender) localStorage.setItem('adhan_user_gender', gender);
                if (bg) localStorage.setItem('adhan_user_bg', bg);
            }
            localStorage.setItem('adhan_onboarded', 'true');
            document.getElementById('onboarding-modal').classList.remove('active');
            applyGreeting();
        };

        function applyGreeting() {
            const name = localStorage.getItem('adhan_user_name');
            if (name && DOM.welcomeMessage) {
                DOM.welcomeMessage.innerText = `Welcome, ${name}`;
                DOM.welcomeMessage.style.display = 'block';
            }
        }

        function initUI() {
            DOM.liveClock = document.getElementById('live-clock');
            DOM.gregDate = document.getElementById('greg-date');
            DOM.hijriDate = document.getElementById('hijri-date');
            DOM.weather = document.getElementById('weather-display');
            DOM.locName = document.getElementById('location-name');
            DOM.currName = document.getElementById('curr-name');
            DOM.currTime = document.getElementById('curr-time');
            DOM.timerDisp = document.getElementById('timer-display');
            DOM.progress = document.getElementById('progress-fill');
            DOM.shuruqWarn = document.getElementById('shuruq-warning');
            DOM.welcomeMessage = document.getElementById('welcome-message');
            DOM.focusTimesList = document.getElementById('focus-times-list');
            DOM.jumuahBanner = document.getElementById('jumuah-banner');

            const settingsBtn = document.getElementById('settings-btn');
            const closeSettingsBtn = document.getElementById('close-settings');
            const settingsModal = document.getElementById('settings-modal');
            const focusBtn = document.getElementById('focus-btn');
            const fsBtn = document.getElementById('fullscreen-btn');

            function closeSettings() {
                settingsModal.classList.remove('active');
                const newMethod = document.getElementById('calc-method').value;
                const newOffset = document.getElementById('manual-offset').value;
                const newHijri = document.getElementById('hijri-offset').value;
                
                if (newMethod != config.method || newOffset != config.offset || newHijri != config.hijriOffset) {
                    config.method = newMethod;
                    config.offset = parseInt(newOffset) || 0;
                    config.hijriOffset = parseInt(newHijri) || 0;
                    
                    localStorage.setItem('adhan_method', config.method);
                    localStorage.setItem('adhan_offset', config.offset);
                    localStorage.setItem('adhan_hijri_offset', config.hijriOffset);
                    localStorage.removeItem(`calendar_${config.lat}_${config.lon}`);
                    fetchPrayerData();
                }
            }

            settingsBtn.addEventListener('click', () => settingsModal.classList.add('active'));
            closeSettingsBtn.addEventListener('click', closeSettings);
            
            settingsModal.addEventListener('click', (e) => {
                if (e.target === settingsModal) {
                    closeSettings();
                }
            });

            focusBtn.addEventListener('click', () => {
                document.body.classList.toggle('focus-mode');
                if(document.body.classList.contains('focus-mode')) window.scrollTo(0,0);
            });
            fsBtn.addEventListener('click', () => {
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen().catch(err => console.log(err));
                } else {
                    if (document.exitFullscreen) document.exitFullscreen();
                }
            });
            
            document.getElementById('adhan-volume').addEventListener('input', (e) => {
                const vol = parseFloat(e.target.value);
                localStorage.setItem('adhan_volume', vol);
                document.querySelectorAll('audio').forEach(a => a.volume = vol);
            });

            document.getElementById('custom-bg-upload').addEventListener('change', (event) => {
                const file = event.target.files[0];
                if(!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.onload = function() {
                        const canvas = document.createElement('canvas');
                        const MAX_WIDTH = 1920; const MAX_HEIGHT = 1080;
                        let width = img.width; let height = img.height;

                        if (width > height && width > MAX_WIDTH) { height *= MAX_WIDTH / width; width = MAX_WIDTH; } 
                        else if (height > MAX_HEIGHT) { width *= MAX_HEIGHT / height; height = MAX_HEIGHT; }
                        
                        canvas.width = width; canvas.height = height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);
                        
                        const dataUrl = canvas.toDataURL('image/jpeg', 0.6); 
                        
                        try {
                            localStorage.setItem('adhan_custom_bg', dataUrl);
                            document.querySelectorAll('.theme-btn').forEach(b => b.classList.toggle('active', b.dataset.themeVal === 'custom'));
                            localStorage.setItem('adhan_theme', 'custom');
                            applySettings();
                        } catch(err) {
                            alert("Image too large to save. Try a smaller image.");
                        }
                    }
                    img.src = e.target.result;
                }
                reader.readAsDataURL(file);
            });
        }

        window.exportPrayerData = function() {
            const data = JSON.parse(localStorage.getItem('adhan_tracker')) || {};
            const dates = Object.keys(data).sort();
            
            if (dates.length === 0) {
                alert("No prayer data to export yet.");
                return;
            }
            
            let csvContent = "Date,Fajr,Dhuhr,Asr,Maghrib,Isha\n";
            
            dates.forEach(date => {
                const p = data[date];
                let row = [
                    date,
                    p.Fajr ? 'Yes' : 'No',
                    p.Dhuhr ? 'Yes' : 'No',
                    p.Asr ? 'Yes' : 'No',
                    p.Maghrib ? 'Yes' : 'No',
                    p.Isha ? 'Yes' : 'No'
                ];
                csvContent += row.join(",") + "\n";
            });

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement("a");
            link.setAttribute("href", url);
            link.setAttribute("download", "adhan_display_tracker.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        };

        function applySettings() {
            const theme = localStorage.getItem('adhan_theme') || 'dynamic';
            const lang = localStorage.getItem('adhan_lang') || 'en';
            const size = localStorage.getItem('adhan_size') || 'normal';
            const audio = localStorage.getItem('adhan_audio') || 'default';
            const source = localStorage.getItem('adhan_daily') || 'quran';
            const wudu = localStorage.getItem('adhan_wudu') === 'true';
            const dailyAlert = localStorage.getItem('adhan_daily_alert') === 'true';
            const vol = localStorage.getItem('adhan_volume') || 1;
            
            config.method = localStorage.getItem('adhan_method') || 3;
            config.offset = parseInt(localStorage.getItem('adhan_offset')) || 0;
            config.hijriOffset = parseInt(localStorage.getItem('adhan_hijri_offset')) || 0;

            document.documentElement.setAttribute('data-theme', theme);
            if (theme !== 'dynamic') document.documentElement.removeAttribute('data-time-of-day');

            document.getElementById('custom-bg-section').style.display = (theme === 'custom') ? 'block' : 'none';

            if (theme === 'custom') {
                const customBg = localStorage.getItem('adhan_custom_bg');
                if (customBg) {
                    document.documentElement.style.setProperty('--bg-image', `url(${customBg})`);
                } else {
                    document.documentElement.style.removeProperty('--bg-image');
                }
            } else {
                document.documentElement.style.removeProperty('--bg-image');
            }

            let rootSize = '16px';
            if (size === 'small') rootSize = '14px';
            if (size === 'large') rootSize = '18px';
            document.documentElement.style.fontSize = rootSize;

            document.getElementById('wudu-toggle').checked = wudu;
            document.getElementById('daily-alert-toggle').checked = dailyAlert;
            document.getElementById('calc-method').value = config.method;
            document.getElementById('manual-offset').value = config.offset;
            document.getElementById('hijri-offset').value = config.hijriOffset;
            document.getElementById('adhan-volume').value = vol;
            document.querySelectorAll('audio').forEach(a => a.volume = parseFloat(vol));

            if(source === 'hadith') document.getElementById('daily-title').setAttribute('data-i18n', 'hadith');
            else document.getElementById('daily-title').setAttribute('data-i18n', 'ayah');

            document.querySelectorAll('.theme-btn').forEach(b => b.classList.toggle('active', b.dataset.themeVal === theme));
            
            // Set the dropdown to the saved language
            document.getElementById('lang-select').value = lang;

            document.querySelectorAll('.text-btn').forEach(b => b.classList.toggle('active', b.dataset.sizeVal === size));
            document.querySelectorAll('.adhan-btn').forEach(b => b.classList.toggle('active', b.dataset.adhanVal === audio));
            document.querySelectorAll('.text-source-btn').forEach(b => b.classList.toggle('active', b.dataset.sourceVal === source));

            applyTranslations(lang);
        }

        function applyTranslations(lang) {
            // FIX: Ensure RTL works perfectly for Urdu just like Arabic
            document.documentElement.dir = (lang === 'ar' || lang === 'ur') ? 'rtl' : 'ltr';

            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (i18n[lang] && i18n[lang][key]) el.innerText = i18n[lang][key];
                else if (i18n['en'][key]) el.innerText = i18n['en'][key];
            });
        }

        document.querySelectorAll('.theme-btn').forEach(btn => btn.addEventListener('click', (e) => { localStorage.setItem('adhan_theme', e.target.dataset.themeVal); applySettings(); updateDynamicTheme(); }));
        document.querySelectorAll('.text-btn').forEach(btn => btn.addEventListener('click', (e) => { localStorage.setItem('adhan_size', e.target.dataset.sizeVal); applySettings(); }));
        document.querySelectorAll('.adhan-btn').forEach(btn => btn.addEventListener('click', (e) => { localStorage.setItem('adhan_audio', e.target.dataset.adhanVal); applySettings(); }));
        document.querySelectorAll('.text-source-btn').forEach(btn => btn.addEventListener('click', (e) => { localStorage.setItem('adhan_daily', e.target.dataset.sourceVal); applySettings(); fetchContent(); }));
        
        // FIX: Replaced button clicks with the dropdown 'change' event listener
        document.getElementById('lang-select').addEventListener('change', (e) => { 
            localStorage.setItem('adhan_lang', e.target.value); 
            applySettings(); 
            fetchContent(); 
        });

        document.getElementById('wudu-toggle').addEventListener('change', (e) => { 
            localStorage.setItem('adhan_wudu', e.target.checked); 
            if (e.target.checked && "Notification" in window) Notification.requestPermission();
        });
        
        document.getElementById('daily-alert-toggle').addEventListener('change', (e) => { 
            localStorage.setItem('adhan_daily_alert', e.target.checked); 
            if (e.target.checked && "Notification" in window) Notification.requestPermission();
        });

        if (window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true) {
            document.getElementById('install-card-section').style.display = 'none';
        }

        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => { e.preventDefault(); deferredPrompt = e; });
        const isIos = () => { return /iphone|ipad|ipod/.test( window.navigator.userAgent.toLowerCase() ); };

        document.getElementById('install-btn').addEventListener('click', async () => {
            if (deferredPrompt) { 
                await deferredPrompt.prompt(); 
                const { outcome } = await deferredPrompt.userChoice;
                deferredPrompt = null; 
            } 
            else if (isIos()) { alert("To install on iOS: Tap the 'Share' icon at the bottom of Safari, scroll down, and select 'Add to Home Screen'."); } 
            else { alert("Tap your browser's menu (‚ãÆ) and select 'Install' or 'Add to Home Screen'."); }
        });

        async function fetchCached(key, url, ttlHours) {
            const cached = localStorage.getItem(key);
            if (cached) {
                const parsed = JSON.parse(cached);
                if (Date.now() - parsed.timestamp < ttlHours * 3600000) return parsed.data;
            }
            try {
                const res = await fetch(url);
                if (!res.ok) throw new Error("Network error");
                const data = await res.json();
                localStorage.setItem(key, JSON.stringify({ timestamp: Date.now(), data }));
                return data;
            } catch (e) {
                if (cached) return JSON.parse(cached).data;
                return null;
            }
        }

        let savedLocs = JSON.parse(localStorage.getItem('adhan_saved_locs')) || [];
        
        function renderLocations() {
            const container = document.getElementById('location-list');
            let htmlStr = `<div style="display: flex; gap: 8px; margin-bottom: 5px;">
                <button class="opt-btn ${isAutoLoc ? 'active' : ''}" style="flex:1;" onclick="enableAutoLocation()">üìç Auto Detect</button>
            </div>`;

            savedLocs.forEach((loc, index) => {
                const isActive = (!isAutoLoc && config.city === loc.name) ? 'active' : '';
                htmlStr += `<div style="display: flex; gap: 8px; margin-top: 8px;">
                    <button class="opt-btn ${isActive}" style="flex:1;" onclick="selectLocation(${index})">${loc.name}</button>
                    <button class="opt-btn" style="flex:0 0 auto; max-width: 45px;" onclick="editLocation(${index})" title="Edit">‚úèÔ∏è</button>
                    <button class="opt-btn" style="flex:0 0 auto; max-width: 45px;" onclick="deleteLocation(${index})" title="Delete">üóëÔ∏è</button>
                </div>`;
            });
            container.innerHTML = htmlStr;
        }

        window.enableAutoLocation = function() {
            isAutoLoc = true; localStorage.setItem('adhan_auto_loc', 'true');
            if(DOM.locName) DOM.locName.innerText = "Detecting...";
            renderLocations(); detectAndApplyAutoLocation(); startAutoLocationInterval();
        };
        
        window.selectLocation = function(index) {
            isAutoLoc = false; localStorage.setItem('adhan_auto_loc', 'false'); stopAutoLocationInterval();
            const loc = savedLocs[index]; config.lat = loc.lat; config.lon = loc.lon; config.city = loc.name;
            if(DOM.locName) DOM.locName.innerText = config.city;
            fetchWeather(); fetchPrayerData(); renderLocations(); calculateQibla();
        }

        window.editLocation = function(index) {
            const newName = prompt("Enter a new display name for this location:", savedLocs[index].name);
            if(newName && newName.trim() !== "") {
                const wasActive = (!isAutoLoc && config.city === savedLocs[index].name);
                savedLocs[index].name = newName.trim(); localStorage.setItem('adhan_saved_locs', JSON.stringify(savedLocs));
                if(wasActive) { config.city = savedLocs[index].name; if(DOM.locName) DOM.locName.innerText = config.city; }
                renderLocations();
            }
        };

        window.deleteLocation = function(index) {
            if(confirm("Are you sure you want to remove '" + savedLocs[index].name + "'?")) {
                const wasActive = (!isAutoLoc && config.city === savedLocs[index].name);
                savedLocs.splice(index, 1); localStorage.setItem('adhan_saved_locs', JSON.stringify(savedLocs));
                if(wasActive) window.enableAutoLocation(); else renderLocations();
            }
        };

        async function addManualLocation() {
            const name = document.getElementById('new-loc-name').value;
            if(!name) return;
            try {
                const res = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(name)}&count=1`);
                const data = await res.json();
                if(data.results && data.results.length > 0) {
                    savedLocs.push({name: data.results[0].name, lat: data.results[0].latitude, lon: data.results[0].longitude});
                    localStorage.setItem('adhan_saved_locs', JSON.stringify(savedLocs));
                    document.getElementById('new-loc-name').value = ''; selectLocation(savedLocs.length - 1); 
                } else { alert("Location not found."); }
            } catch(e) { console.error(e); }
        }

        async function detectAndApplyAutoLocation() {
            const data = await fetchCached('adhan_location_auto', 'https://ipapi.co/json/', 2);
            if(data && data.latitude) { 
                config.lat = data.latitude; config.lon = data.longitude; config.city = data.city || data.country_name; 
                if(DOM.locName) DOM.locName.innerText = config.city + ' (Auto)';
            }
            fetchWeather(); fetchPrayerData(); calculateQibla();
        }

        function startAutoLocationInterval() {
            if (autoLocationInterval) clearInterval(autoLocationInterval);
            autoLocationInterval = setInterval(() => { localStorage.removeItem('adhan_location_auto'); detectAndApplyAutoLocation(); }, 2 * 60 * 60 * 1000);
        }
        function stopAutoLocationInterval() { if (autoLocationInterval) clearInterval(autoLocationInterval); autoLocationInterval = null; }

        async function initLocation() {
            if (isAutoLoc) { await detectAndApplyAutoLocation(); startAutoLocationInterval(); } 
            else if (savedLocs.length > 0) {
                let activeIndex = savedLocs.findIndex(l => l.name === config.city); if (activeIndex === -1) activeIndex = 0;
                config.lat = savedLocs[activeIndex].lat; config.lon = savedLocs[activeIndex].lon; config.city = savedLocs[activeIndex].name;
                if(DOM.locName) DOM.locName.innerText = config.city;
                fetchWeather(); fetchPrayerData(); calculateQibla();
            } else { window.enableAutoLocation(); }
            renderLocations();
        }

        function updateDynamicTheme() {
            if (localStorage.getItem('adhan_theme') !== 'dynamic') { document.documentElement.removeAttribute('data-time-of-day'); return; }
            let timeOfDay = 'night';
            if (state.nextPrayer) {
                if (state.nextPrayer.name === 'Sunrise') timeOfDay = 'fajr';
                else if (['Dhuhr', 'Asr', 'Maghrib'].includes(state.nextPrayer.name)) timeOfDay = 'day';
            }
            document.documentElement.setAttribute('data-time-of-day', timeOfDay);
        }

        window.previewAudio = function(type, btnElement) { 
            const audioEl = document.getElementById('audio-' + type); const isPlaying = !audioEl.paused;
            document.querySelectorAll('audio').forEach(a => { a.pause(); a.currentTime = 0; }); 
            document.querySelectorAll('.preview-btn').forEach(b => { b.innerText = '‚ñ∂'; b.title = 'Play'; });
            if (!isPlaying && audioEl) { 
                audioEl.play().catch(e => console.log(e)); btnElement.innerText = '‚èπ'; btnElement.title = 'Stop';
                audioEl.onended = () => { btnElement.innerText = '‚ñ∂'; btnElement.title = 'Play'; };
            }
        };

        function playAudio(triggerType) {
            const audioPref = localStorage.getItem('adhan_audio') || 'default';
            if (triggerType === 'adhan' && audioPref !== 'none') {
                const audioEl = document.getElementById('audio-' + audioPref) || document.getElementById('audio-default');
                audioEl.play().catch(e => console.log(e));
            } else if (triggerType === 'chime') { document.getElementById('audio-chime').play().catch(e => console.log(e)); }
        }

        window.setStream = function(type) {
            document.getElementById('btn-makkah').classList.toggle('active', type === 'makkah');
            document.getElementById('btn-madinah').classList.toggle('active', type === 'madinah');
            document.getElementById('stream-link').href = type === 'makkah' 
                ? 'https://www.youtube.com/results?search_query=makkah+live' 
                : 'https://www.youtube.com/results?search_query=madina+live';
        };

        let tasbihCount = 0;
        window.incrementTasbih = function() {
            tasbihCount++; document.getElementById('tasbih-btn').innerText = tasbihCount;
            if (tasbihCount % 33 === 0) {
                if (navigator.vibrate) navigator.vibrate(200);
                document.getElementById('tasbih-btn').classList.add('glow');
                setTimeout(() => document.getElementById('tasbih-btn').classList.remove('glow'), 250);
            }
        };
        window.resetTasbih = function() { tasbihCount = 0; document.getElementById('tasbih-btn').innerText = 0; };

        const TRACK_PRAYERS = ["Fajr", "Dhuhr", "Asr", "Maghrib", "Isha"];
        let prayerData = JSON.parse(localStorage.getItem('adhan_tracker')) || {};
        let trackerOffsetDays = 0;

        window.jumpToDate = function(targetDateStr) {
            const parts = targetDateStr.split('-');
            const targetDate = new Date(parts[0], parts[1] - 1, parts[2]);
            const today = new Date();
            today.setHours(0,0,0,0); targetDate.setHours(0,0,0,0);
            
            trackerOffsetDays = Math.round((targetDate - today) / 86400000);
            updateTrackerView();
            document.getElementById('times-card').scrollIntoView({ behavior: 'smooth' });
        };

        window.changeTrackerDate = async function(delta) { trackerOffsetDays += delta; await updateTrackerView(); }

        async function fetchPrayerData() {
            const now = new Date(); const month = now.getMonth() + 1; const year = now.getFullYear();
            
            const adjParam = config.hijriOffset !== 0 ? `&adjustment=${config.hijriOffset}` : '';
            const data = await fetchCached(`calendar_${config.lat}_${config.lon}_${config.hijriOffset}`, `https://api.aladhan.com/v1/calendar/${year}/${month}?latitude=${config.lat}&longitude=${config.lon}&method=${config.method}${adjParam}`, 720); 
            
            if(data && data.code === 200) {
                state.monthlyCache = data.data; 
                
                const todayData = state.monthlyCache[now.getDate() - 1]; 
                state.prayers = todayData.timings; 
                
                const h = todayData.date.hijri;
                let hDay = parseInt(h.day) + config.hijriOffset;
                if(hDay > 30) hDay -= 30; if(hDay < 1) hDay += 30; 
                
                if(DOM.hijriDate) DOM.hijriDate.innerText = `${hDay} ${h.month.en} ${h.year}`;
                if(parseInt(h.month.number) === 9) { state.isRamadan = true; activateRamadanMode(hDay); } 
                else { state.isRamadan = false; calcRamadanCountdown(parseInt(h.month.number), hDay); }
                
                document.getElementById('midnight-time').innerText = addOffsetToString(state.prayers.Midnight); 
                document.getElementById('last-third-time').innerText = addOffsetToString(state.prayers.Lastthird);
                
                determinePrayerState(); updateDynamicTheme(); updateTrackerView();
            }
        }

        async function updateTrackerView() {
            const targetDate = new Date(); targetDate.setDate(targetDate.getDate() + trackerOffsetDays);
            const isoDateStr = targetDate.getFullYear() + '-' + String(targetDate.getMonth() + 1).padStart(2, '0') + '-' + String(targetDate.getDate()).padStart(2, '0');
            document.getElementById('trackerDate').innerText = isoDateStr;
            const timesList = document.getElementById('daily-times-list');
            
            if (state.monthlyCache && state.monthlyCache.length >= targetDate.getDate() && targetDate.getMonth() === new Date().getMonth()) {
                 const dayData = state.monthlyCache[targetDate.getDate() - 1];
                 renderPrayerTracker(dayData.timings, isoDateStr);
            } else {
                 timesList.innerHTML = '<div style="text-align: center; color: var(--danger); padding: 20px;">Please return to current month to sync offline data.</div>';
            }
        }

        function renderPrayerTracker(timings, dateStr) {
            if (!prayerData[dateStr]) { prayerData[dateStr] = { Fajr: false, Dhuhr: false, Asr: false, Maghrib: false, Isha: false }; localStorage.setItem('adhan_tracker', JSON.stringify(prayerData)); }
            
            let htmlStr = '';
            const seq = ["Fajr", "Sunrise", "Dhuhr", "Asr", "Maghrib", "Isha"];
            
            seq.forEach(p => {
                const displayTime = addOffsetToString(timings[p]);
                if(p === "Sunrise") {
                    htmlStr += `<div style="display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-color); padding: 12px 5px; margin-bottom: 4px;">
                        <span style="color: var(--danger); font-weight: bold; text-transform: uppercase; font-size: 0.85rem; flex: 1;">${p}</span>
                        <span style="color: var(--danger); font-family: 'Courier New', monospace; font-size: 1.25rem; font-weight: bold; text-align: right;">${displayTime}</span>
                        <div style="width: 35px; margin-left: 15px;"></div>
                    </div>`;
                } else {
                    const isChecked = prayerData[dateStr][p] ? 'checked' : '';
                    htmlStr += `<label style="display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-color); padding: 12px 5px; margin-bottom: 4px; cursor: pointer; transition: background 0.2s; border-radius: 6px;" onmouseover="this.style.background='rgba(255,255,255,0.03)'" onmouseout="this.style.background='transparent'">
                        <span style="color: var(--text-main); font-weight: bold; text-transform: uppercase; font-size: 0.85rem; flex: 1;">${p}</span>
                        <span style="color: var(--gold); font-family: 'Courier New', monospace; font-size: 1.25rem; font-weight: bold; text-align: right;">${displayTime}</span>
                        <div style="width: 35px; margin-left: 15px; display: flex; justify-content: flex-end;">
                            <input type="checkbox" id="chk_${p}" ${isChecked} onchange="togglePrayer('${p}', '${dateStr}')" style="transform: scale(1.5); margin: 0; accent-color: var(--gold); cursor: pointer;">
                        </div>
                    </label>`;
                }
            });
            
            document.getElementById('daily-times-list').innerHTML = htmlStr;
            updateStatistics();
        }

        window.togglePrayer = function(prayerName, dateStr) {
            const isNowChecked = document.getElementById('chk_' + prayerName).checked;
            prayerData[dateStr][prayerName] = isNowChecked; localStorage.setItem('adhan_tracker', JSON.stringify(prayerData));
            const prayersDone = TRACK_PRAYERS.filter(p => prayerData[dateStr][p]).length;
            if (prayersDone === 5 && isNowChecked && typeof confetti !== 'undefined') confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 }, colors: ['#D4AF37', '#2ecc71', '#ffffff'] });
            updateStatistics();
        };

        function updateStatistics() {
            const d = new Date(); const actualTodayStr = d.getFullYear() + '-' + String(d.getMonth() + 1).padStart(2, '0') + '-' + String(d.getDate()).padStart(2, '0');
            const allDates = Object.keys(prayerData).sort().reverse();
            let weekCompleted = 0, weekMax = 0, monthCompleted = 0, monthMax = 0, entryCount = 0;

            let streak = 0;
            for (let i = 0; i < 365; i++) {
                let streakDate = new Date(); streakDate.setDate(streakDate.getDate() - i);
                let dStr = streakDate.getFullYear() + '-' + String(streakDate.getMonth() + 1).padStart(2, '0') + '-' + String(streakDate.getDate()).padStart(2, '0');
                
                let doneCount = prayerData[dStr] ? TRACK_PRAYERS.filter(p => prayerData[dStr][p]).length : 0;
                
                if (doneCount === 5) { streak++; } 
                else if (i === 0) { continue; } 
                else { break; } 
            }
            document.getElementById('streak-display').innerText = `üî• ${streak} Day Streak`;

            let historyHTML = '';

            allDates.forEach((date, index) => {
                const dayRecord = prayerData[date]; const prayersDone = TRACK_PRAYERS.filter(p => dayRecord[p]).length;
                if (index < 7) { weekCompleted += prayersDone; weekMax += 5; }
                if (index < 30) { monthCompleted += prayersDone; monthMax += 5; }
                if (date !== actualTodayStr) {
                    entryCount++;
                    const color = prayersDone === 5 ? 'var(--success)' : (prayersDone === 0 ? 'var(--danger)' : 'var(--gold)');
                    const starIcon = prayersDone === 5 ? ' ‚≠ê' : '';
                    
                    historyHTML += `<div class="history-row" onclick="jumpToDate('${date}')" title="Edit ${date}">
                        <span style="color: var(--text-main); font-weight: 500;">${date}</span>
                        <span style="color: ${color}; font-weight: bold;">${prayersDone} / 5${starIcon}</span>
                    </div>`;
                }
            });

            document.getElementById('historyLog').innerHTML = historyHTML || '<div style="color: var(--text-muted); text-align: center; margin-top: 20px; font-style: italic;">No past data yet.</div>';
            document.getElementById('weekScore').innerText = weekCompleted; document.getElementById('weekTotal').innerText = weekMax;
            document.getElementById('weekBar').style.width = weekMax > 0 ? (weekCompleted / weekMax * 100) + '%' : '0%';
            document.getElementById('monthScore').innerText = monthCompleted; document.getElementById('monthTotal').innerText = monthMax;
            document.getElementById('monthBar').style.width = monthMax > 0 ? (monthCompleted / monthMax * 100) + '%' : '0%';
        }

        function renderFocusModeTimes(activePrayerName) {
            if(!state.prayers || !DOM.focusTimesList) return;
            const seq = ["Fajr", "Sunrise", "Dhuhr", "Asr", "Maghrib", "Isha"];
            let focusHTML = '';
            
            seq.forEach(p => {
                const displayTime = addOffsetToString(state.prayers[p]);
                const isCurrent = (p === activePrayerName);
                
                const textColor = p === "Sunrise" ? "var(--danger)" : (isCurrent ? "var(--gold)" : "var(--text-main)");
                const bgStyle = isCurrent ? "background: var(--highlight-bg); border-radius: 6px; padding: 8px 10px;" : "padding: 8px 10px;";
                const arrow = isCurrent ? `<span style="color: var(--gold); margin-right: 5px;">‚ûî</span>` : `<span style="visibility:hidden; margin-right: 5px;">‚ûî</span>`;

                focusHTML += `<div style="display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-color); ${bgStyle}">
                    <div style="display: flex; align-items: center;">${arrow}<span style="color: ${textColor}; font-weight: ${isCurrent?'bold':'normal'};">${p}</span></div>
                    <span style="color: var(--gold); font-family: 'Courier New', monospace; font-weight: bold; font-size: 1.2rem;">${displayTime}</span>
                </div>`;
            });
            DOM.focusTimesList.innerHTML = focusHTML;
        }

        async function init() {
            initUI();
            try { applySettings(); } catch(e) {}
            requestWakeLock(); 
            updateGregorian(); 
            
            setInterval(() => { if(DOM.liveClock) DOM.liveClock.innerText = new Date().toLocaleTimeString('en-US', { hour12: false }); }, 1000);
            
            if(new Date().getDay() === 5 && DOM.jumuahBanner) {
                DOM.jumuahBanner.style.display = 'block';
            }

            try { await initLocation(); } catch(e) {}
            fetchContent(); 
            
            setInterval(tickTimer, 1000); 
            setInterval(rotateNames, 10000); 
            
            checkOnboarding();
        }

        async function fetchWeather() {
            const data = await fetchCached(`weather_${config.lat}_${config.lon}`, `https://api.open-meteo.com/v1/forecast?latitude=${config.lat}&longitude=${config.lon}&current_weather=true`, 1);
            if(data && data.current_weather && DOM.weather) DOM.weather.innerText = `${Math.round(data.current_weather.temperature)}¬∞C | ${data.current_weather.weathercode < 3 ? 'Clear' : 'Cloudy'}`;
        }

        async function fetchContent() {
            const lang = localStorage.getItem('adhan_lang') || 'en';
            const dailySource = localStorage.getItem('adhan_daily') || 'quran';
            const dayOfYear = Math.floor((new Date() - new Date(new Date().getFullYear(), 0, 0)) / 1000 / 60 / 60 / 24);
            
            if (dailySource === 'quran') {
                const quranEditions = { en: 'en.asad', tr: 'tr.diyanet', nl: 'nl.leemhuis', fr: 'fr.hamidullah', de: 'de.aburida', es: 'es.cortes', ar: 'ar.alafasy' };
                const edition = quranEditions[lang] || 'en.asad';
                const ayahNumber = (dayOfYear % 6236) + 1;
                const ayahData = await fetchCached(`quran_${edition}_${ayahNumber}`, `https://api.alquran.cloud/v1/ayah/${ayahNumber}/${edition}`, 24);
                if(ayahData && ayahData.data) {
                    document.getElementById('daily-text').innerText = `"${ayahData.data.text}"`;
                    let surahName = lang === 'ar' ? ayahData.data.surah.name : ayahData.data.surah.englishName;
                    document.getElementById('daily-ref').innerText = surahName + " " + ayahData.data.surah.number + ":" + ayahData.data.numberInSurah;
                }
            } else {
                const hIndex = dayOfYear % dailyHadiths.length;
                document.getElementById('daily-text').innerText = `"${dailyHadiths[hIndex].text}"`; 
                document.getElementById('daily-ref').innerText = dailyHadiths[hIndex].ref;
            }

            const dIndex = dayOfYear % dailyDuas.length;
            document.getElementById('dua-text').innerText = `"${dailyDuas[dIndex].text}"`; 
            document.getElementById('dua-ref').innerText = dailyDuas[dIndex].ref;

            const namesData = await fetchCached('allah_names_v1', 'https://api.aladhan.com/v1/asmaAlHusna', 720);
            if(namesData && namesData.data) { state.namesList = namesData.data; rotateNames(); }
        }

        function determinePrayerState() {
            if(!state.prayers || !state.prayers.Fajr) return;
            const now = new Date(); const seq = ["Fajr", "Sunrise", "Dhuhr", "Asr", "Maghrib", "Isha"];
            
            for(let i=0; i<seq.length; i++) {
                const pTime = parseTime(state.prayers[seq[i]]);
                if(pTime > now) {
                    state.nextPrayer = { name: seq[i], time: pTime };
                    let prevName = i === 0 ? "Isha" : seq[i-1]; let prevTime = parseTime(state.prayers[prevName]);
                    if(i === 0) prevTime.setDate(prevTime.getDate() - 1);
                    state.prevPrayerTime = prevTime;
                    
                    if(DOM.currName) DOM.currName.innerText = prevName; 
                    if(DOM.currTime) DOM.currTime.innerText = addOffsetToString(state.prayers[prevName]);
                    if(DOM.currName) DOM.currName.style.color = prevName === "Sunrise" ? "var(--danger)" : "var(--gold)";
                    if(DOM.shuruqWarn) DOM.shuruqWarn.style.display = prevName === "Sunrise" ? 'block' : 'none';
                    
                    renderFocusModeTimes(prevName);
                    updateDynamicTheme(); state.notified10Min = false; return;
                }
            }
            const fTime = parseTime(state.prayers.Fajr); fTime.setDate(fTime.getDate()+1);
            state.nextPrayer = { name: "Fajr", time: fTime }; state.prevPrayerTime = parseTime(state.prayers.Isha);
            
            if(DOM.currName) { DOM.currName.innerText = "Isha"; DOM.currName.style.color = "var(--gold)"; }
            if(DOM.currTime) DOM.currTime.innerText = addOffsetToString(state.prayers.Isha); 
            if(DOM.shuruqWarn) DOM.shuruqWarn.style.display = 'none';
            
            renderFocusModeTimes("Isha"); 
            updateDynamicTheme(); state.notified10Min = false;
        }

        function tickTimer() {
            const now = new Date();
            
            if (now.getHours() === 9 && now.getMinutes() === 0) {
                if (!state.dailyAlertTriggered && localStorage.getItem('adhan_daily_alert') === 'true') {
                    showNotification("Daily Inspiration", { body: document.getElementById('daily-text').innerText });
                    state.dailyAlertTriggered = true;
                }
            } else { state.dailyAlertTriggered = false; }
            
            if(!state.nextPrayer) return;
            const diffMs = state.nextPrayer.time - now;
            
            if (diffMs <= 600000 && diffMs > 599000 && !state.notified10Min) { 
                if(localStorage.getItem('adhan_wudu') === 'true' && state.nextPrayer.name !== "Sunrise") { 
                    playAudio('chime'); 
                    showNotification("Prayer Time Approaching", { body: `10 minutes until ${state.nextPrayer.name}. Time for Wudu.` });
                }
                state.notified10Min = true; 
            }

            if (diffMs <= 0) { 
                if(!state.adhanPlayed) { 
                    if (state.nextPrayer.name !== "Sunrise") playAudio('adhan'); 
                    state.adhanPlayed = true; 
                }
                determinePrayerState(); state.adhanPlayed = false; return; 
            }
            
            const h = Math.floor(diffMs/3600000).toString().padStart(2,'0');
            const m = Math.floor((diffMs%3600000)/60000).toString().padStart(2,'0');
            const s = Math.floor((diffMs%60000)/1000).toString().padStart(2,'0');
            if(DOM.timerDisp) DOM.timerDisp.innerText = `${h}:${m}:${s}`;
            
            if(state.prevPrayerTime && DOM.progress) {
                const total = state.nextPrayer.time - state.prevPrayerTime;
                const elapsed = now - state.prevPrayerTime;
                DOM.progress.style.width = `${(elapsed/total)*100}%`;
            }

            if(state.isRamadan) {
                const fajrTime = parseTime(state.prayers.Fajr); const maghribTime = parseTime(state.prayers.Maghrib);
                let targetTime, label;
                if(now >= fajrTime && now < maghribTime) { targetTime = maghribTime; label = "Time until Iftar (Maghrib)"; } 
                else { targetTime = parseTime(state.prayers.Fajr); if (now >= maghribTime) targetTime.setDate(targetTime.getDate() + 1); label = "Time until Imsak (Fajr)"; }
                const fastDiff = targetTime - now;
                const fh = Math.floor(fastDiff/3600000).toString().padStart(2,'0'); const fm = Math.floor((fastDiff%3600000)/60000).toString().padStart(2,'0'); const fs = Math.floor((fastDiff%60000)/1000).toString().padStart(2,'0');
                document.getElementById('fasting-label').innerText = label; document.getElementById('fasting-timer').innerText = `${fh}:${fm}:${fs}`;
            }
        }

        function showNotification(title, customOptions = {}) {
            const options = { icon: "images/adhan display muslim prayer times dashboard logo.png", badge: "images/adhan display muslim prayer times dashboard logo.png", vibrate: [200, 100, 200], ...customOptions };
            if (!("Notification" in window) || Notification.permission !== "granted") return;
            if (navigator.serviceWorker && navigator.serviceWorker.controller) navigator.serviceWorker.ready.then(reg => reg.showNotification(title, options));
            else new Notification(title, options);
        }

        function activateRamadanMode(hijriDay) { 
            document.getElementById('ramadan-countdown-container').style.display = 'none'; document.getElementById('ramadan-panel').style.display = 'block'; 
            let ashraName = "Mercy (Days 1-10)"; if (hijriDay > 10 && hijriDay <= 20) ashraName = "Forgiveness (Days 11-20)"; if (hijriDay > 20) ashraName = "Refuge (Days 21-30)";
            document.getElementById('ashra-label').innerText = `Ashra: ${ashraName}`; document.getElementById('ramadan-day-label').innerText = `Day ${hijriDay} of 30`;
            document.getElementById('ashra-progress-fill').style.width = `${(hijriDay / 30) * 100}%`;
        }

        function calcRamadanCountdown(m, d) { 
            document.getElementById('ramadan-countdown-container').style.display = 'flex'; document.getElementById('ramadan-panel').style.display = 'none'; 
            let daysLeft = m < 9 ? Math.floor(((9 - m - 1) * 29.5) + (30 - d)) : Math.floor(((12 - m + 8) * 29.5) + (30 - d));
            document.getElementById('ramadan-val').innerText = daysLeft > 0 ? daysLeft : 0;
        }

        function calculateQibla() {
            const lat1 = config.lat * (Math.PI/180), lon1 = config.lon * (Math.PI/180), lat2 = 21.4225 * (Math.PI/180), lon2 = 39.8262 * (Math.PI/180);
            const y = Math.sin(lon2 - lon1) * Math.cos(lat2), x = Math.cos(lat1) * Math.sin(lat2) - Math.sin(lat1) * Math.cos(lat2) * Math.cos(lon2 - lon1);
            state.qiblaDegree = Math.round(((Math.atan2(y, x) * 180/Math.PI) + 360) % 360);
            document.getElementById('qibla-degree').innerText = state.qiblaDegree + "¬∞";
        }

        function rotateNames() {
            if(!state.namesList || !state.namesList.length) return;
            const item = state.namesList[Math.floor(Math.random()*state.namesList.length)];
            document.getElementById('allah-ar').innerText = item.name; document.getElementById('allah-en').innerText = item.transliteration;
            document.getElementById('allah-meaning').innerText = item.en.meaning; 
        }

        function parseTime(t) { 
            const d = new Date(); 
            const timeClean = t.split(' ')[0]; 
            const [h, m] = timeClean.split(':'); 
            return new Date(d.getFullYear(), d.getMonth(), d.getDate(), parseInt(h), parseInt(m) + config.offset); 
        }
        
        function addOffsetToString(t) {
            const dateObj = parseTime(t);
            return String(dateObj.getHours()).padStart(2, '0') + ':' + String(dateObj.getMinutes()).padStart(2, '0');
        }

        function updateGregorian() { const n = new Date(); if(DOM.gregDate) DOM.gregDate.innerText = `${n.getDate()}/${n.getMonth()+1}/${n.getFullYear()}`; }

        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => { navigator.serviceWorker.register('sw.js').catch((err) => { console.log('SW error: ', err); }); });
        }

        init();
    </script>
</body>
</html>
