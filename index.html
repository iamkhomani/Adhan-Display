<!DOCTYPE html>
<html lang="en">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-BEKQEF4RR5"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-BEKQEF4RR5');
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#050505">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Adhan Display">
    <link rel="apple-touch-icon" href="images/adhan display muslim prayer times dashboard logo.png">

    <link rel="icon" type="image/png" href="images/adhan display muslim prayer times dashboard logo.png">
    <link rel="manifest" href="manifest.json">

    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600;800&display=swap" rel="stylesheet">

    <title>Adhan Display: Live Prayer Times & Qibla</title>
    <meta name="description" content="A free, luxury Islamic dashboard featuring live prayer times, Qibla direction, Quran verses, and Makkah streaming for any device.">
    
    <style>
        /* === THEME VARIABLES === */
        :root {
            --bg-image: url('images/adhan display muslim prayer times dashboard background.jpg');
            --gold: #D4AF37;
            --gold-dim: #997d26;
            --glass-bg: rgba(20, 20, 20, 0.85);
            --glass-header: rgba(0, 0, 0, 0.65);
            --text-main: #f0f0f0;
            --text-muted: #aaaaaa;
            --border-color: #333333;
            --progress-bg: #222222;
            --shadow-color: rgba(0,0,0,0.5);
            --danger: #ff4444; --success: #2ecc71;
        }

        [data-theme="light"] {
            --bg-image: url('images/background-white.jpg');
            --gold: #b8972e; --gold-dim: #8a7122;
            --glass-bg: rgba(255, 255, 255, 0.85);
            --glass-header: rgba(240, 240, 240, 0.85);
            --text-main: #1a1a1a; --text-muted: #555555;
            --border-color: #dddddd; --progress-bg: #e0e0e0;
            --shadow-color: rgba(0,0,0,0.1);
        }

        [data-theme="green"] {
            --bg-image: url('images/background-green.png');
            --gold: #D4AF37; --gold-dim: #997d26;
            --glass-bg: rgba(10, 35, 20, 0.85);
            --glass-header: rgba(5, 20, 10, 0.8);
            --text-main: #f0f0f0; --text-muted: #cccccc;
            --border-color: #1a4d2e; --progress-bg: #0a1f12;
            --shadow-color: rgba(0,0,0,0.6);
        }

        html { font-size: 16px; transition: font-size 0.3s ease; }

        body {
            background-image: var(--bg-image); background-size: cover;
            background-position: center; background-attachment: fixed;
            background-color: #050505; color: var(--text-main);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0; min-height: 100vh; padding-bottom: 80px;
            display: flex; flex-direction: column; overflow-x: hidden;
            transition: background-image 0.5s ease, color 0.5s ease;
        }

        /* RTL (Arabic) Support */
        html[dir="rtl"] body { font-family: 'Tajawal', 'Segoe UI', sans-serif; }
        html[dir="rtl"] .top-left-logo { left: auto; right: 20px; }
        html[dir="rtl"] .settings-toggle { right: auto; left: 20px; }
        html[dir="rtl"] .close-btn { right: auto; left: 20px; }

        .dashboard-container {
            max-width: 1400px; margin: 0 auto; padding: 20px;
            display: grid; grid-template-columns: repeat(12, 1fr);
            gap: 20px; flex: 1; position: relative; width: 100%; box-sizing: border-box;
        }

        .top-left-logo { position: absolute; top: 20px; left: 20px; width: clamp(50px, 8vw, 70px); height: auto; z-index: 10; }

        .settings-toggle {
            position: absolute; top: 20px; right: 20px; background: var(--glass-bg);
            border: 1px solid var(--border-color); color: var(--text-main); font-size: 1.5rem;
            width: 45px; height: 45px; border-radius: 50%; cursor: pointer; z-index: 100;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 10px var(--shadow-color); transition: transform 0.3s, border-color 0.3s;
        }
        .settings-toggle:hover { transform: rotate(90deg); border-color: var(--gold); }

        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7); display: none; align-items: center; justify-content: center;
            z-index: 1000; backdrop-filter: blur(5px); opacity: 0; transition: opacity 0.3s ease;
        }
        .modal-overlay.active { display: flex; opacity: 1; }
        .settings-panel {
            background: var(--glass-bg); border: 1px solid var(--border-color); padding: 30px;
            border-radius: 12px; width: 90%; max-width: 400px; position: relative;
            color: var(--text-main); box-shadow: 0 10px 30px var(--shadow-color);
        }
        .close-btn { position: absolute; top: 15px; right: 20px; background: transparent; border: none; font-size: 1.8rem; color: var(--text-main); cursor: pointer; }
        .setting-group { margin-bottom: 25px; }
        .setting-group label { display: block; margin-bottom: 10px; font-weight: bold; color: var(--gold); text-transform: uppercase; font-size: 0.9rem; letter-spacing: 1px; }
        .flex-options { display: flex; gap: 8px; flex-wrap: wrap; }
        .opt-btn { flex: 1; min-width: 40px; padding: 10px; background: transparent; border: 1px solid var(--border-color); color: var(--text-main); border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.2s; text-align: center; }
        .opt-btn:hover { border-color: var(--gold); }
        .opt-btn.active { background: var(--gold); color: #050505; border-color: var(--gold); }

        /* Cards & Components */
        .card { background: var(--glass-bg); border: 1px solid var(--border-color); border-radius: 12px; padding: 20px; backdrop-filter: blur(10px); box-shadow: 0 4px 20px var(--shadow-color); transition: all 0.3s ease; display: flex; flex-direction: column; justify-content: center; align-items: center; grid-column: span 12; }
        .card:hover { border-color: var(--gold-dim); transform: translateY(-2px); }
        .widget-title { color: var(--gold-dim); text-transform: uppercase; font-size: 0.8rem; border-bottom: 1px solid var(--border-color); width: 100%; text-align: center; padding-bottom: 5px; margin-bottom: 15px; letter-spacing: 1px; }
        
        .header-section { grid-column: span 12; text-align: center; margin-bottom: 20px; display: flex; justify-content: center; margin-top: 10px; width: 100%; }
        .title-wrapper { background: var(--glass-header); backdrop-filter: blur(8px); padding: clamp(15px, 4vw, 20px) clamp(20px, 5vw, 40px); border-radius: 20px; border: 1px solid var(--border-color); box-shadow: 0 10px 30px var(--shadow-color); width: 100%; max-width: 800px; box-sizing: border-box; }
        h1 { font-family: 'Cinzel', serif; color: var(--gold); font-size: clamp(1.8rem, 5vw, 2.8rem); margin: 0; text-transform: uppercase; letter-spacing: clamp(1px, 2vw, 3px); text-shadow: 0 2px 10px var(--shadow-color); }
        h2 { font-size: clamp(0.75rem, 2vw, 0.9rem); color: var(--text-muted); font-weight: 400; margin: 5px 0 10px 0; letter-spacing: 0.5px; text-transform: uppercase; }
        
        .info-panel { grid-column: span 12; display: flex; flex-wrap: wrap; justify-content: space-around; align-items: center; background: var(--glass-header); border-radius: 12px; padding: 15px; border: 1px solid var(--border-color); gap: 15px; box-shadow: 0 4px 10px var(--shadow-color); }
        .date-box { text-align: center; min-width: 100px; flex: 1; }
        .date-label { color: var(--gold-dim); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 3px; }
        .date-val { font-size: clamp(1rem, 3vw, 1.2rem); font-weight: bold; color: var(--text-main); }
        #live-clock { font-size: clamp(1.4rem, 4vw, 1.8rem); font-family: 'Courier New', monospace; color: var(--text-main); }

        .prayer-hero { text-align: center; border: 2px solid var(--gold); position: relative; }
        .prayer-name-display { font-size: clamp(2.5rem, 8vw, 3.5rem); color: var(--gold); font-weight: 800; line-height: 1.1; margin: 10px 0; }
        .countdown-display { font-size: clamp(1.8rem, 6vw, 2.2rem); font-family: 'Courier New', monospace; color: var(--text-main); }
        .progress-container { width: 100%; height: 12px; background: var(--progress-bg); margin-top: 20px; border-radius: 6px; overflow: hidden; border: 1px solid var(--border-color); }
        .progress-bar { height: 100%; background: var(--gold); width: 0%; transition: width 1s linear; }

        /* Shuruq Warning */
        #shuruq-warning { color: var(--danger); font-size: 0.9rem; font-weight: bold; display: none; margin-bottom: 10px; letter-spacing: 1px; }

        .btn-gold { background: transparent; border: 2px solid var(--gold); color: var(--gold); padding: 12px 20px; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; cursor: pointer; text-decoration: none; transition: 0.3s; border-radius: 6px; font-weight: bold; display: inline-flex; align-items: center; justify-content: center; gap: 10px; margin-top: 10px; width: 100%; max-width: 300px; box-sizing: border-box; text-align: center; }
        .btn-gold:hover { background: var(--gold); color: #050505; box-shadow: 0 0 15px rgba(212, 175, 55, 0.4); }

        footer { margin-top: auto; text-align: center; padding: 20px; border-top: 1px solid var(--border-color); background: var(--glass-header); width: 100%; box-sizing: border-box; }
        .footer-logo { width: 80px; height: auto; opacity: 0.8; }

        @media (min-width: 768px) {
            .top-left-logo { position: absolute; top: 20px; left: 20px; display: block; margin: 0; }
            html[dir="rtl"] .top-left-logo { left: auto; right: 20px; }
            .text-widget, .night-widget, .names-widget, .ramadan-widget, .video-card, .qibla-card { grid-column: span 6; }
            .install-card { grid-column: span 12; }
        }
        @media (min-width: 1024px) {
            .prayer-hero { grid-column: span 6; grid-row: span 2; } 
            .names-widget, .ramadan-widget, .video-card, .qibla-card { grid-column: span 3; }
        }
        @media (max-width: 767px) {
            .top-left-logo { position: relative; top: 0; left: 0; display: block; margin: 0 auto 15px auto; }
            .settings-toggle { top: 15px; right: 15px; width: 40px; height: 40px; }
            .info-panel { flex-direction: column; }
            .date-box { width: 100%; padding: 5px 0; border-bottom: 1px solid var(--border-color); }
            .date-box:last-child { border-bottom: none; }
        }
    </style>
</head>
<body>

    <button id="settings-btn" class="settings-toggle" aria-label="Settings">⚙️</button>
    <div id="settings-modal" class="modal-overlay">
        <div class="settings-panel">
            <button id="close-settings" class="close-btn">&times;</button>
            <h3 data-i18n="pref" style="color:var(--gold); margin-top:0; border-bottom:1px solid var(--border-color); padding-bottom:10px;">Preferences</h3>
            
            <div class="setting-group">
                <label data-i18n="lang">Language</label>
                <div class="flex-options">
                    <button class="opt-btn lang-btn" data-lang-val="en">EN</button>
                    <button class="opt-btn lang-btn" data-lang-val="nl">NL</button>
                    <button class="opt-btn lang-btn" data-lang-val="fr">FR</button>
                    <button class="opt-btn lang-btn" data-lang-val="de">DE</button>
                    <button class="opt-btn lang-btn" data-lang-val="es">ES</button>
                    <button class="opt-btn lang-btn" data-lang-val="ar">AR</button>
                </div>
            </div>

            <div class="setting-group">
                <label data-i18n="theme">Theme</label>
                <div class="flex-options">
                    <button class="opt-btn theme-btn" data-theme-val="dark">Dark</button>
                    <button class="opt-btn theme-btn" data-theme-val="light">Light</button>
                    <button class="opt-btn theme-btn" data-theme-val="green">Green</button>
                </div>
            </div>

            <div class="setting-group">
                <label data-i18n="size">Text Size</label>
                <div class="flex-options">
                    <button class="opt-btn text-btn" data-size-val="small">A-</button>
                    <button class="opt-btn text-btn" data-size-val="normal">A</button>
                    <button class="opt-btn text-btn" data-size-val="large">A+</button>
                </div>
            </div>
        </div>
    </div>

    <main class="dashboard-container">
        <img src="images/adhan display muslim prayer times dashboard logo.png" alt="Adhan Display Logo" class="top-left-logo">

        <header class="header-section">
            <div class="title-wrapper">
                <h1>Adhan Display Dashboard</h1>
                <h2 data-i18n="subtitle">The Ultimate Free Islamic Prayer Times & Qibla Dashboard</h2>
                <div style="font-family: 'Times New Roman', serif; font-style: italic; color: var(--text-main); font-size: clamp(0.9rem, 2vw, 1.1rem); border-top: 1px solid var(--border-color); padding-top: 10px;">La ilaha illa Allah, Muhammadur Rasul Allah</div>
            </div>
        </header>

        <section class="info-panel">
            <div class="date-box">
                <div class="date-label" data-i18n="greg">Gregorian</div>
                <div class="date-val" id="greg-date">--/--/----</div>
            </div>
            <div class="date-box">
                <div class="date-label" data-i18n="time">Current Time</div>
                <div class="date-val" id="live-clock">--:--:--</div>
                <div id="weather-display" style="font-size: 0.85rem; color:var(--gold-dim);">Loading...</div>
            </div>
            <div class="date-box">
                <div class="date-label" data-i18n="loc">Location</div>
                <div class="location-val" id="location-name" style="color:var(--text-muted);">Detecting...</div>
            </div>
            <div class="date-box">
                <div class="date-label" data-i18n="hijri">Hijri</div>
                <div class="date-val" id="hijri-date">-- -- ----</div>
            </div>
        </section>

        <section id="ramadan-panel" style="display: none; grid-column: span 12; background: var(--glass-bg); border: 1px solid var(--success); padding: 15px; border-radius: 12px; text-align: center; box-shadow: 0 4px 10px var(--shadow-color);">
            <div id="fasting-label" style="color:var(--success); text-transform:uppercase; font-size:0.8rem; letter-spacing: 1px;">Fasting Timer</div>
            <div id="fasting-timer" style="font-size: clamp(1.8rem, 5vw, 2.5rem); font-family: 'Courier New', monospace; font-weight: bold; color: var(--text-main); margin-top: 5px;">--:--:--</div>
        </section>

        <section class="card prayer-hero">
            <div class="date-label" id="status-label" data-i18n="curr">Current Prayer</div>
            <div class="prayer-name-display" id="curr-name">Loading...</div>
            <div id="shuruq-warning" data-i18n="nopray">* Not permissible to pray *</div>
            <div class="prayer-time-display" id="curr-time" style="font-size:1.5rem; color:var(--text-muted);">--:--</div>
            <div style="margin-top: auto; width: 100%;">
                <div class="date-label" id="next-label" data-i18n="next">Next Prayer In</div>
                <div class="countdown-display" id="timer-display">--:--:--</div>
                <div class="progress-container"><div class="progress-bar" id="progress-fill"></div></div>
            </div>
        </section>

        <article class="card text-widget">
            <div class="widget-title" data-i18n="ayah">Ayah of the Day</div>
            <div id="quran-text" style="font-style:italic; text-align:center; color:var(--text-main); font-size: 1.1rem;">Loading...</div>
            <div id="quran-ref" style="color:var(--gold); font-size:0.8rem; margin-top:10px; width:100%; text-align:right;"></div>
        </article>

        <section class="card night-widget">
            <div class="widget-title" data-i18n="qiyam">Night Prayers (Qiyam)</div>
            <div style="display:flex; justify-content:space-around; width:100%;">
                <div style="text-align:center;"><div id="midnight-time" style="font-size:1.3rem; color:var(--gold);">--:--</div><div style="font-size:0.7rem; color:var(--text-muted);" data-i18n="mid">Midnight</div></div>
                <div style="text-align:center;"><div id="last-third-time" style="font-size:1.3rem; color:var(--gold);">--:--</div><div style="font-size:0.7rem; color:var(--text-muted);" data-i18n="tahajjud">Tahajjud</div></div>
            </div>
        </section>

        <article class="card names-widget">
            <div class="widget-title" data-i18n="allah">Name of Allah</div>
            <div id="allah-ar" style="font-size:2.2rem; color:var(--gold); font-family: 'Tajawal', sans-serif;">--</div>
            <div id="allah-en" style="font-weight:bold; color:var(--text-main);">--</div>
            <div id="allah-meaning" style="font-size:0.8rem; font-style:italic; color:var(--text-muted); text-align: center;">--</div>
        </article>

        <article class="card ramadan-widget">
            <div class="widget-title" data-i18n="ramadan">Ramadan</div>
            
            <div id="ramadan-countdown-container" style="text-align: center; width: 100%;">
                <div id="ramadan-val" style="font-size: clamp(1.8rem, 5vw, 2.5rem); font-weight: bold;">--</div>
                <div style="font-size:0.8rem; color:var(--gold-dim);" data-i18n="days">Days Remaining</div>
            </div>

            <div id="ramadan-active-container" style="display: none; width: 100%; text-align: center;">
                <div style="font-size: clamp(1.8rem, 5vw, 2.5rem); font-weight: bold; color: var(--success); text-transform: uppercase; margin-bottom: 10px;">Ramadan!</div>
                
                <div style="font-size: 0.85rem; color: var(--gold-dim); margin-bottom: 5px;" id="ashra-label">Ashra: Mercy (Days 1-10)</div>
                <div class="progress-container" style="height: 10px; margin-top: 5px;">
                    <div class="progress-bar" id="ashra-progress-fill" style="background: var(--success); width: 0%;"></div>
                </div>
                <div style="font-size: 0.75rem; color: var(--text-muted); margin-top: 5px;" id="ramadan-day-label">Day -- of 30</div>
            </div>
        </article>

        <section class="card video-card">
            <div class="widget-title" data-i18n="makkah">Makkah Live</div>
            <img src="images/qibla.png" alt="Qibla Indicator" style="width: 50px; height: auto; margin: 10px 0;">
            <a href="https://www.youtube.com/watch?v=yH_PIhe-I0s" target="_blank" class="btn-gold">
                <span style="height: 10px; width: 10px; background-color: var(--danger); border-radius: 50%; display: inline-block; box-shadow: 0 0 8px var(--danger);"></span> 
                <span data-i18n="watch">Watch Stream</span>
            </a>
        </section>

        <section class="card qibla-card">
            <div class="widget-title" data-i18n="qibla">Qibla Direction</div>
            <div id="qibla-degree" style="font-size:2rem; font-weight:bold; color:var(--text-main);">--°</div>
            <div style="font-size:0.8rem; color:var(--text-muted); margin-bottom: 10px;" data-i18n="north">from true North</div>
            <a href="https://qiblafinder.withgoogle.com/" target="_blank" class="btn-gold" data-i18n="ar">Open AR Finder</a>
        </section>

        <section class="card install-card" style="padding: 30px;">
            <div class="widget-title" style="margin-bottom: 5px; border: none;" data-i18n="getapp">Get the App</div>
            <button id="install-btn" class="btn-gold" style="width: auto; padding: 12px 40px; border-radius: 50px;" data-i18n="install">Install App</button>
        </section>

    </main>

    <footer>
        <img src="images/adhan display muslim prayer times dashboard logo.png" alt="Logo" class="footer-logo">
        <p style="font-size: 0.8rem; color: var(--text-muted); margin-top: 10px;">&copy; 2026 Adhan Display. Serving the Ummah.</p>
    </footer>

    <script>
        // === MEERTALIGHEID (Woordenboek) ===
        const i18n = {
            en: { subtitle: "The Ultimate Free Islamic Prayer Times & Qibla Dashboard", greg: "Gregorian", time: "Current Time", loc: "Location", hijri: "Hijri", curr: "Current Prayer", next: "Next Prayer In", ayah: "Ayah of the Day", qiyam: "Night Prayers", mid: "Midnight", tahajjud: "Tahajjud", allah: "Name of Allah", ramadan: "Ramadan", days: "Days Remaining", makkah: "Makkah Live", watch: "Watch Stream", qibla: "Qibla Direction", north: "from true North", ar: "Open AR Finder", getapp: "Get the App", install: "Install App", pref: "Preferences", theme: "Theme", size: "Text Size", lang: "Language", nopray: "* Not permissible to pray *" },
            nl: { subtitle: "Het Ultieme Islamitische Gebedstijden Dashboard", greg: "Gregoriaans", time: "Huidige Tijd", loc: "Locatie", hijri: "Hidzjra", curr: "Huidig Gebed", next: "Volgend Gebed In", ayah: "Vers van de Dag", qiyam: "Nachtgebeden", mid: "Middernacht", tahajjud: "Tahajjud", allah: "Naam van Allah", ramadan: "Ramadan", days: "Dagen Te Gaan", makkah: "Mekka Live", watch: "Bekijk Stream", qibla: "Qibla Richting", north: "van ware noorden", ar: "Open AR Zoeker", getapp: "Download de App", install: "Installeer App", pref: "Instellingen", theme: "Thema", size: "Tekstgrootte", lang: "Taal", nopray: "* Bidden is niet toegestaan *" },
            fr: { subtitle: "Le Tableau de Bord Islamique Ultime", greg: "Grégorien", time: "Heure Actuelle", loc: "Emplacement", hijri: "Hégire", curr: "Prière Actuelle", next: "Prochaine Prière", ayah: "Verset du Jour", qiyam: "Prières Nocturnes", mid: "Minuit", tahajjud: "Tahajjud", allah: "Nom d'Allah", ramadan: "Ramadan", days: "Jours Restants", makkah: "Mecque en Direct", watch: "Regarder le Stream", qibla: "Direction de la Qibla", north: "du vrai nord", ar: "Ouvrir AR Finder", getapp: "Obtenir l'App", install: "Installer l'App", pref: "Préférences", theme: "Thème", size: "Taille du Texte", lang: "Langue", nopray: "* Prière non permise *" },
            de: { subtitle: "Das Ultimative Islamische Dashboard", greg: "Gregorianisch", time: "Aktuelle Zeit", loc: "Ort", hijri: "Hidschra", curr: "Aktuelles Gebet", next: "Nächstes Gebet In", ayah: "Vers des Tages", qiyam: "Nachtgebete", mid: "Mitternacht", tahajjud: "Tahajjud", allah: "Name Allahs", ramadan: "Ramadan", days: "Verbleibende Tage", makkah: "Mekka Live", watch: "Stream Ansehen", qibla: "Qibla-Richtung", north: "vom wahren Norden", ar: "AR-Finder Öffnen", getapp: "App Holen", install: "App Installieren", pref: "Einstellungen", theme: "Thema", size: "Textgröße", lang: "Sprache", nopray: "* Beten ist nicht erlaubt *" },
            es: { subtitle: "El Panel de Oración Islámica Definitivo", greg: "Gregoriano", time: "Hora Actual", loc: "Ubicación", hijri: "Hégira", curr: "Oración Actual", next: "Próxima Oración En", ayah: "Versículo del Día", qiyam: "Oraciones Nocturnas", mid: "Medianoche", tahajjud: "Tahajjud", allah: "Nombre de Alá", ramadan: "Ramadán", days: "Días Restantes", makkah: "La Meca en Vivo", watch: "Ver Transmisión", qibla: "Dirección Qibla", north: "desde el norte", ar: "Abrir Buscador AR", getapp: "Obtener App", install: "Instalar App", pref: "Preferencias", theme: "Tema", size: "Tamaño", lang: "Idioma", nopray: "* No está permitido orar *" },
            ar: { subtitle: "لوحة أوقات الصلاة الإسلامية المطلقة", greg: "ميلادي", time: "الوقت الحالي", loc: "الموقع", hijri: "هجري", curr: "الصلاة الحالية", next: "الصلاة القادمة في", ayah: "آية اليوم", qiyam: "قيام الليل", mid: "منتصف الليل", tahajjud: "تهجد", allah: "اسم الله", ramadan: "رمضان", days: "أيام متبقية", makkah: "مكة مباشر", watch: "شاهد البث", qibla: "اتجاه القبلة", north: "من الشمال الحقيقي", ar: "فتح باحث الواقع المعزز", getapp: "احصل على التطبيق", install: "تثبيت التطبيق", pref: "الإعدادات", theme: "السمة", size: "حجم النص", lang: "اللغة", nopray: "* الصلاة غير جائزة *" }
        };

        let config = { lat: 52.0907, lon: 5.1214, city: 'Netherlands', method: 3 };
        let state = { prayers: {}, nextPrayer: null, prevPrayerTime: null, namesList: [], isRamadan: false };

        // === SLIMME CACHE FUNCTIE ===
        async function fetchCached(key, url, ttlHours) {
            const cached = localStorage.getItem(key);
            if (cached) {
                const parsed = JSON.parse(cached);
                if (Date.now() - parsed.timestamp < ttlHours * 3600000) return parsed.data;
            }
            try {
                const res = await fetch(url);
                const data = await res.json();
                localStorage.setItem(key, JSON.stringify({ timestamp: Date.now(), data }));
                return data;
            } catch (e) {
                console.error('Fetch error:', e);
                if (cached) return JSON.parse(cached).data;
                throw e;
            }
        }

        // === INSTELLINGEN & VERTALINGEN ===
        const settingsModal = document.getElementById('settings-modal');
        document.getElementById('settings-btn').addEventListener('click', () => settingsModal.classList.add('active'));
        document.getElementById('close-settings').addEventListener('click', () => settingsModal.classList.remove('active'));

        function applySettings() {
            const theme = localStorage.getItem('adhan_theme') || 'dark';
            const textSize = localStorage.getItem('adhan_size') || 'normal';
            const lang = localStorage.getItem('adhan_lang') || 'en';
            
            document.documentElement.setAttribute('data-theme', theme);
            document.querySelectorAll('.theme-btn').forEach(btn => btn.classList.toggle('active', btn.dataset.themeVal === theme));

            let fontSize = '16px';
            if (textSize === 'small') fontSize = '14px';
            if (textSize === 'large') fontSize = '19px';
            document.documentElement.style.fontSize = fontSize;
            document.querySelectorAll('.text-btn').forEach(btn => btn.classList.toggle('active', btn.dataset.sizeVal === textSize));

            document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if(i18n[lang] && i18n[lang][key]) el.innerText = i18n[lang][key];
            });
            document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.toggle('active', btn.dataset.langVal === lang));
        }

        document.querySelectorAll('.theme-btn').forEach(btn => btn.addEventListener('click', (e) => { localStorage.setItem('adhan_theme', e.target.dataset.themeVal); applySettings(); }));
        document.querySelectorAll('.text-btn').forEach(btn => btn.addEventListener('click', (e) => { localStorage.setItem('adhan_size', e.target.dataset.sizeVal); applySettings(); }));
        document.querySelectorAll('.lang-btn').forEach(btn => btn.addEventListener('click', (e) => { 
            localStorage.setItem('adhan_lang', e.target.dataset.langVal); 
            applySettings(); 
            fetchContent(); 
        }));

        // === INITIALISATIE (PARALLEL LADEN) ===
        async function init() {
            applySettings(); updateGregorian(); 
            await detectLocation(); 
            
            await Promise.all([ fetchWeather(), fetchPrayerData(), fetchContent() ]);
            
            calculateQibla();
            setInterval(tickTimer, 1000); 
            setInterval(() => { document.getElementById('live-clock').innerText = new Date().toLocaleTimeString('en-US', { hour12: false }); }, 1000);
            setInterval(rotateNames, 10000); 
            setInterval(fetchPrayerData, 3600000); 
        }

        async function detectLocation() {
            try {
                const data = await fetchCached('adhan_location', 'https://ipapi.co/json/', 12);
                if(data.latitude) { config.lat = data.latitude; config.lon = data.longitude; config.city = data.city || data.country_name; }
                document.getElementById('location-name').innerText = config.city;
            } catch (e) { document.getElementById('location-name').innerText = config.city; }
        }

        async function fetchWeather() {
            try {
                const cacheKey = `weather_${config.lat}_${config.lon}`;
                const data = await fetchCached(cacheKey, `https://api.open-meteo.com/v1/forecast?latitude=${config.lat}&longitude=${config.lon}&current_weather=true`, 1);
                document.getElementById('weather-display').innerText = `${Math.round(data.current_weather.temperature)}°C | ${data.current_weather.weathercode < 3 ? 'Clear' : 'Cloudy'}`;
            } catch (e) {}
        }

        async function fetchPrayerData() {
            const now = new Date();
            const dateStr = `${now.getDate()}-${now.getMonth()+1}-${now.getFullYear()}`;
            const cacheKey = `prayers_${config.lat}_${config.lon}_${dateStr}`;
            
            const data = await fetchCached(cacheKey, `https://api.aladhan.com/v1/timings/${dateStr}?latitude=${config.lat}&longitude=${config.lon}&method=${config.method}`, 24);
            
            if(data.code === 200) {
                state.prayers = data.data.timings;
                const h = data.data.date.hijri;
                document.getElementById('hijri-date').innerText = `${h.day} ${h.month.en} ${h.year}`;
                
                // RAMADAN CHECK
                if(parseInt(h.month.number) === 9) { 
                    state.isRamadan = true; 
                    activateRamadanMode(parseInt(h.day)); 
                } else { 
                    state.isRamadan = false; 
                    calcRamadanCountdown(parseInt(h.month.number), parseInt(h.day)); 
                }
                
                document.getElementById('midnight-time').innerText = state.prayers.Midnight;
                document.getElementById('last-third-time').innerText = state.prayers.Lastthird;
                determinePrayerState();
            }
        }

        async function fetchContent() {
            const lang = localStorage.getItem('adhan_lang') || 'en';
            const quranEditions = { en: 'en.asad', nl: 'nl.leemhuis', fr: 'fr.hamidullah', de: 'de.aburida', es: 'es.cortes', ar: 'ar.alafasy' };
            const edition = quranEditions[lang] || 'en.asad';
            const todayStr = new Date().toDateString();
            
            try {
                const ayahData = await fetchCached(`quran_${edition}_${todayStr}`, `https://api.alquran.cloud/v1/ayah/${Math.floor(Math.random()*6236)+1}/${edition}`, 24);
                document.getElementById('quran-text').innerText = `"${ayahData.data.text}"`;
                let surahName = lang === 'ar' ? ayahData.data.surah.name : ayahData.data.surah.englishName;
                document.getElementById('quran-ref').innerText = surahName + " " + ayahData.data.surah.number + ":" + ayahData.data.numberInSurah;
                
                const namesData = await fetchCached('allah_names_v1', 'https://api.aladhan.com/v1/asmaAlHusna', 720);
                state.namesList = namesData.data; rotateNames();
            } catch(e) {}
        }

        // === TIMERS, CALCULATIONS & STATE ===
        function determinePrayerState() {
            const now = new Date();
            const seq = ["Fajr", "Sunrise", "Dhuhr", "Asr", "Maghrib", "Isha"];
            for(let i=0; i<seq.length; i++) {
                const pTime = parseTime(state.prayers[seq[i]]);
                if(pTime > now) {
                    state.nextPrayer = { name: seq[i], time: pTime };
                    let prevName = i === 0 ? "Isha" : seq[i-1];
                    let prevTime = parseTime(state.prayers[prevName]);
                    if(i === 0) prevTime.setDate(prevTime.getDate() - 1);
                    state.prevPrayerTime = prevTime;
                    
                    document.getElementById('curr-name').innerText = prevName;
                    document.getElementById('curr-time').innerText = state.prayers[prevName];
                    document.getElementById('curr-name').style.color = prevName === "Sunrise" ? "var(--danger)" : "var(--gold)";
                    
                    // SHURUQ WARNING CHECK
                    if (prevName === "Sunrise") {
                        document.getElementById('shuruq-warning').style.display = 'block';
                    } else {
                        document.getElementById('shuruq-warning').style.display = 'none';
                    }

                    return;
                }
            }
            const fTime = parseTime(state.prayers.Fajr); fTime.setDate(fTime.getDate()+1);
            state.nextPrayer = { name: "Fajr", time: fTime }; state.prevPrayerTime = parseTime(state.prayers.Isha);
            document.getElementById('curr-name').innerText = "Isha"; 
            document.getElementById('curr-name').style.color = "var(--gold)";
            document.getElementById('shuruq-warning').style.display = 'none';
        }

        function tickTimer() {
            if(!state.nextPrayer) return;
            const now = new Date();
            const diff = state.nextPrayer.time - now;
            if(diff <= 0) { determinePrayerState(); return; }
            
            const h = Math.floor(diff/3600000).toString().padStart(2,'0');
            const m = Math.floor((diff%3600000)/60000).toString().padStart(2,'0');
            const s = Math.floor((diff%60000)/1000).toString().padStart(2,'0');
            document.getElementById('timer-display').innerText = `${h}:${m}:${s}`;
            
            if(state.prevPrayerTime) {
                const total = state.nextPrayer.time - state.prevPrayerTime;
                const elapsed = now - state.prevPrayerTime;
                document.getElementById('progress-fill').style.width = `${(elapsed/total)*100}%`;
            }

            // RAMADAN FASTING TIMER LOGIC (Top Panel)
            if(state.isRamadan) {
                const fajrTime = parseTime(state.prayers.Fajr);
                const maghribTime = parseTime(state.prayers.Maghrib);
                
                let targetTime, label;
                if(now >= fajrTime && now < maghribTime) {
                    targetTime = maghribTime;
                    label = "Time until Iftar (Maghrib)";
                } else {
                    targetTime = parseTime(state.prayers.Fajr);
                    if (now >= maghribTime) targetTime.setDate(targetTime.getDate() + 1);
                    label = "Time until Imsak (Fajr)";
                }
                
                const fastDiff = targetTime - now;
                const fh = Math.floor(fastDiff/3600000).toString().padStart(2,'0');
                const fm = Math.floor((fastDiff%3600000)/60000).toString().padStart(2,'0');
                const fs = Math.floor((fastDiff%60000)/1000).toString().padStart(2,'0');
                
                document.getElementById('fasting-label').innerText = label;
                document.getElementById('fasting-timer').innerText = `${fh}:${fm}:${fs}`;
            }
        }

        // RAMADAN DISPLAY FUNCTIONS
        function activateRamadanMode(hijriDay) { 
            document.getElementById('ramadan-countdown-container').style.display = 'none';
            document.getElementById('ramadan-active-container').style.display = 'block';
            document.getElementById('ramadan-panel').style.display = 'block'; // Toon de Vasten Timer bovenin

            // Ashra Progress Logic
            let ashraName = "Mercy (Days 1-10)";
            if (hijriDay > 10 && hijriDay <= 20) ashraName = "Forgiveness (Days 11-20)";
            if (hijriDay > 20) ashraName = "Refuge (Days 21-30)";
            
            document.getElementById('ashra-label').innerText = `Ashra: ${ashraName}`;
            document.getElementById('ramadan-day-label').innerText = `Day ${hijriDay} of 30`;
            document.getElementById('ashra-progress-fill').style.width = `${(hijriDay / 30) * 100}%`;
        }

        function calcRamadanCountdown(m, d) {
            document.getElementById('ramadan-countdown-container').style.display = 'block'; 
            document.getElementById('ramadan-active-container').style.display = 'none'; 
            document.getElementById('ramadan-panel').style.display = 'none'; 
            
            let daysLeft;
            if (m < 9) {
                daysLeft = Math.floor(((9 - m - 1) * 29.5) + (30 - d));
            } else {
                daysLeft = Math.floor(((12 - m + 8) * 29.5) + (30 - d));
            }
            document.getElementById('ramadan-val').innerText = daysLeft > 0 ? daysLeft : 0;
        }

        function calculateQibla() {
            const lat1 = config.lat * (Math.PI/180), lon1 = config.lon * (Math.PI/180);
            const lat2 = 21.4225 * (Math.PI/180), lon2 = 39.8262 * (Math.PI/180);
            const y = Math.sin(lon2 - lon1) * Math.cos(lat2);
            const x = Math.cos(lat1) * Math.sin(lat2) - Math.sin(lat1) * Math.cos(lat2) * Math.cos(lon2 - lon1);
            document.getElementById('qibla-degree').innerText = Math.round(((Math.atan2(y, x) * 180/Math.PI) + 360) % 360) + "°";
        }

        function rotateNames() {
            if(!state.namesList.length) return;
            const item = state.namesList[Math.floor(Math.random()*state.namesList.length)];
            document.getElementById('allah-ar').innerText = item.name;
            document.getElementById('allah-en').innerText = item.transliteration;
            document.getElementById('allah-meaning').innerText = item.en.meaning; 
        }

        function parseTime(t) { const d = new Date(); const [h, m] = t.split(':'); return new Date(d.getFullYear(), d.getMonth(), d.getDate(), h, m); }
        function updateGregorian() { const n = new Date(); document.getElementById('greg-date').innerText = `${n.getDate()}/${n.getMonth()+1}/${n.getFullYear()}`; }

        // === PWA & INSTALLATION LOGIC ===
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => { e.preventDefault(); deferredPrompt = e; });
        
        // Detect iOS
        const isIos = () => {
          const userAgent = window.navigator.userAgent.toLowerCase();
          return /iphone|ipad|ipod/.test( userAgent );
        }

        document.getElementById('install-btn').addEventListener('click', async () => {
            if (deferredPrompt) { 
                deferredPrompt.prompt(); 
                deferredPrompt = null; 
            } else if (isIos()) {
                alert("To install on iOS: Tap the 'Share' icon at the bottom of Safari, scroll down, and select 'Add to Home Screen'.");
            } else { 
                alert("Tap your browser's menu (⋮) and select 'Install' or 'Add to Home Screen'."); 
            }
        });

        init();
    </script>
</body>
</html>
